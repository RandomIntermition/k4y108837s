import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KaW1wb3J0IHVybGxpYgppbXBvcnQgdXJsbGliMgppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHJlCmltcG9ydCBvcwppbXBvcnQgYmFzZTY0CmltcG9ydCB4Ym1jcGx1Z2luCmltcG9ydCB4Ym1jZ3VpCmltcG9ydCB4Ym1jYWRkb24KaW1wb3J0IHhibWN2ZnMKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgY29va2llbGliCmZyb20gQmVhdXRpZnVsU291cCBpbXBvcnQgQmVhdXRpZnVsU3RvbmVTb3VwLCBCZWF1dGlmdWxTb3VwLCBCZWF1dGlmdWxTT0FQCnRyeToKICAgIGltcG9ydCBqc29uCmV4Y2VwdDoKICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24KaW1wb3J0IHRpbWUKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBfRWRpdAoKTmZsID0gJycKRm9vdGJhbGwgPSAnJwpDcmlja2V0ID0gJycKVGVubmlzID0gJycgCkJveGluZyA9ICcnCkdvbGYgPSAnJwpNb3RvcnNwb3J0cyA9ICcnClJ1Z2J5ID0gJycKSG9ja2V5ID0gJycKTmJhID0gJycKRGFydHMgPSAnJwpXd2UgPSAnJwpIb3JzZV9SYWNpbmcgPSAnJwpVZmMgPSAnJwpCYXNlYmFsbCA9ICcnCgkKcmVzb2x2ZV91cmw9WycxZmljaGllci5jb20nLCAnMjRoZC5iZScsICdhbGxkZWJyaWQuY29tJywgJ2FsbG15dmlkZW9zLm5ldCcsICdhbGx2aWQuY2gnLCAnYXVlbmdpbmUuY29tJywgJ2Jhbmt1cGxvYWQuY29tJywgJ2Jlc3RzdHJlYW1zLm5ldCcsICdicmlza2ZpbGUuY29tJywgJ2Nhc3RhbXAuY29tJywgJ2NsaWNrbnVwbG9hZC5jb20nLCAnY2xpY2tudXBsb2FkLm1lJywgJ2NsaWNrbnVwbG9hZC5saW5rJywgJ2NsaWNrbnVwbG9hZC5vcmcnLCAnY2xvdWR5LmVjJywgJ2Nsb3VkemlsbGEudG8nLCAnbmVvZHJpdmUuY28nLCAnY3J1bmNoeXJvbGwuY29tJywgJ2RhY2xpcHMuaW4nLCAnZGFjbGlwcy5jb20nLCAnZGFpbHltb3Rpb24uY29tJywgJ2RpdnhzdGFnZS5ldScsICdkaXZ4c3RhZ2UubmV0JywgJ2RpdnhzdGFnZS50bycsICdjb3VsZHRpbWUudG8nLCAnZWNvc3RyZWFtLnR2JywgJ2V4YXNoYXJlLmNvbScsICdlc3RyZWFtLnRvJywgJ2ZhY2Vib29rLmNvbScsICdmYXN0cGxheS5jYycsICdmYXN0cGxheS50bycsICdmYXN0cGxheS5zeCcsICdmZW1iZWQuY29tJywgJ2ZpbGVob290LmNvbScsICdmaWxlbnVrZS5jb20nLCAnZmlsZXB1cC5uZXQnLCAnZmlsbXNob3dvbmxpbmUubmV0JywgJ2ZsYXNoeC50dicsICdwbHVzLmdvb2dsZS5jb20nLCAnZ29vZ2xldmlkZW8uY29tJywgJ3BpY2FzYXdlYi5nb29nbGUuY29tJywgJ2dvb2dsZXVzZXJjb250ZW50LmNvbScsICdnb29nbGVkcml2ZS5jb20nLCAnZ29yaWxsYXZpZC5pbicsICdnb3JpbGxhdmlkLmNvbScsICdnb3JpbGxhdmlkLmluJywgJ2dyaWZ0aG9zdC5jb20nLCAnaHVnZWZpbGVzLm5ldCcsICdpZG93YXRjaC5uZXQnLCAnaW5kYXZpZGVvLmh1JywgJ2lzaGFyZWQuZXUnLCAnamV0bG9hZC50dicsICdraW5nZmlsZXMubmV0JywgJ2xldHdhdGNoLnVzJywgJ2xldHdhdGNoLnRvJywgJ3ZpZHNoYXJlLnVzJywgJ21haWwucnUnLCAnbXkubWFpbC5ydScsICd2aWRlb2FwaS5teS5tYWlsLnJ1JywgJ2FwaS52aWRlby5tYWlsLnJ1JywgJ21lZ2EtZGVicmlkLmV1JywgJ21lZ2FtcDQubmV0JywgJ21lcnNhbGFheWl0dGVuLmNvbScsICdtb3ZkaXZ4LmNvbScsICdtb3Zwb2QubmV0JywgJ21vdnBvZC5pbicsICdtb3ZzaGFyZS5uZXQnLCAnd2hvbGVjbG91ZC5uZXQnLCAnbXA0ZW5naW5lLmNvbScsICdtcDRzdHJlYW0uY29tJywgJ21wNHVwbG9hZC5jb20nLCAnbXl2aWRzdHJlYW0ubmV0JywgJ25vc3ZpZGVvLmNvbScsICdub3Nsb2NrZXIuY29tJywgJ2F1cm9yYXZpZC50bycsICdub3ZhbW92LmNvbScsICdub3d2aWRlby5zeCcsICdub3d2aWRlby5ldScsICdub3d2aWRlby5jaCcsICdub3d2aWRlby5zeCcsICdub3d2aWRlby5jbycsICdub3d2aWRlby5saScsICdub3d2aWRlby5lYycsICdub3d2aWRlby5hdCcsICdub3d2aWRlby5mbycsICdvay5ydScsICdvZG5va2xhc3NuaWtpLnJ1JywgJ29wZW5sb2FkLmlvJywgJ29wZW5sb2FkLmNvJywgJ3BsYXk0NC5uZXQnLCAncGxheWVkLnRvJywgJ3BsYXloZC52aWRlbycsICdwbGF5aGQuZm8nLCAncGxheXUubmV0JywgJ3BsYXl1Lm1lJywgJ3BsYXl3aXJlLmNvbScsICdQcmVtaXVtaXplLm1lJywgJ3ByaW1lc2hhcmUudHYnLCAncHJvbXB0ZmlsZS5jb20nLCAncHVyZXZpZC5jb20nLCAncmFwaWR2aWRlby53cycsICdyYXBpZHZpZGVvLmNvbScsICdyZy50bycsICdyYXBpZGdhdG9yLm5ldCcsICdhcGkucmVhbC1kZWJyaWQuY29tJywgJ3ByZW1pdW0ucnBuZXQuYml6JywgJ3J1dHViZS5ydScsICdzaGFyZWQyLm1lJywgJ3NoYXJlZC5zeCcsICdzaGFyZXJlcG8uY29tJywgJ3NoYXJlc2l4LmNvbScsICdzaW1wbHktZGVicmlkLmNvbScsICdzcGVlZHBsYXkueHl6JywgJ3NwZWVkcGxheS51cycsICdzcGVlZHBsYXkzLnB3JywgJ3NwZWVkdmlkZW8ubmV0JywgJ3N0YWdldnUuY29tJywgJ3N0cmVhbWNsb3VkLmV1JywgJ3N0cmVhbWluLnRvJywgJ3N0cmVhbS5tb2UnLCAnc3RyZWFtYW5nby5jb20nLCAnc3RyZWFtY2hlcnJ5LmNvbScsICd0ZXJhbWl4ZXIuY29tJywgJ3RoZXZpZGVvLm1lJywgJ3RoZXZpZC5uZXQnLCAndGhldmlkZW9zLnR2JywgJ3RvbHRzZC1mZWwudGsnLCAndHJvbGx2aWQubmV0JywgJ3R1bmUucGsnLCAndHVzZmlsZXMubmV0JywgJ3R3aXRjaC50dicsICd1cDJzdHJlYW0uY29tJywgJ3VwbG9hZC5hZicsICd1cGxvYWRjLmNvbScsICd1cGxvYWRjLmNoJywgJ3phbGFhLmNvbScsICd1cGxvYWR4Lm9yZycsICd1cHRvYm94LmNvbScsICd1cHRvc3RyZWFtLmNvbScsICd1c2VyZmlsZXMuY29tJywgJ3VzZXJzY2xvdWQuY29tJywgJ3ZlZWhkLmNvbScsICd2ZW9oLmNvbScsICd2aWQuYWcnLCAndmlkYnVsbC5jb20nLCAndmlkY3JhenkubmV0JywgJ3VwbG9hZGNyYXp5Lm5ldCcsICd0aGV2aWRlb2JlZS50bycsICd2aWRlb2JveGVyLmNvJywgJ3ZpZGdnLnRvJywgJ3ZpZC5nZycsICd2aWRlb2h1dC50bycsICd2aWRlb21lZ2EudHYnLCAndmlkZW9yYWoudG8nLCAndmlkZW9yZXYuY2MnLCAndmlkZW9za3kudG8nLCAndmlkZW8udHQnLCAndmlkZW93ZWVkLmVzJywgJ2JpdHZpZC5zeCcsICd2aWRlb3dlZWQuY29tJywgJ3ZpZGVvd29vZC50dicsICdieXpvby5vcmcnLCAncGxheXBhbmRhLm5ldCcsICd2aWRlb3pvby5tZScsICd2aWRlb3dpbmcubWUnLCAndmlkZW93aW5nLm1lJywgJ2Vhc3l2aWRlby5tZScsICdwbGF5NDQubmV0JywgJ3BsYXliYi5tZScsICd2ZXJ5c3RyZWFtLmNvbScsICd2aWRlbzQ0Lm5ldCcsICd2aWRpby5zeCcsICd2aWRsb3gubWUnLCAndmlkb3phLm5ldCcsICd2aWQubWUnLCAndmlkc3BvdC5uZXQnLCAndmlkdG8ubWUnLCAndmlkdXAubWUnLCAndmlkdXAub3JnJywgJ3ZpZHppLnR2JywgJ3ZpbWVvLmNvbScsICd2aXZvLnN4JywgJ3ZrLmNvbScsICd2a3Bhc3MuY29tJywgJ3ZvZGxvY2tlci5jb20nLCAndnNoYXJlLmlvJywgJ3ZzaGFyZS5ldScsICd3YXRjaGVycy50bycsICd3YXRjaG9ubGluZS50bycsICd3YXRjaHZpZGVvLnVzJywgJ3dhdGNodmlkZW8yLnVzJywgJ3dhdGNodmlkZW8zLnVzJywgJ3dhdGNodmlkZW80LnVzJywgJ3dhdGNodmlkZW81LnVzJywgJ3dhdGNodmlkZW82LnVzJywgJ3dhdGNodmlkZW83LnVzJywgJ3dhdGNodmlkZW84LnVzJywgJ3dhdGNodmlkZW85LnVzJywgJ3dlc2hhcmUubWUnLCAneHZpZHN0YWdlLmNvbScsICd5b3Vsb2wuYml6JywgJ3NoaXRtb3ZpZS5jb20nLCAneW91cnVwbG9hZC5jb20nLCAneW91dHViZS5jb20nLCAneW91dHUuYmUnLCAneW91d2F0Y2gub3JnJywgJ2FwaS56ZXZlcmEuY29tJywgJ3pldHRhaG9zdC50dicsICd6c3RyZWFtLnRvJ10KZ19pZ25vcmVTZXRSZXNvbHZlZD1bJ3BsdWdpbi52aWRlby5kcmFtYXNvbmxpbmUnLCdwbHVnaW4udmlkZW8uZjRtVGVzdGVyJywncGx1Z2luLnZpZGVvLnNoYWhpZG1iY25ldCcsJ3BsdWdpbi52aWRlby5TcG9ydHNEZXZpbCcsJ3BsdWdpbi5zdHJlYW0udmF1Z2hubGl2ZS50dicsJ3BsdWdpbi52aWRlby5aZW1UVi1zaGFuaSddCgpjbGFzcyBOb1JlZGlyZWN0aW9uKHVybGxpYjIuSFRUUEVycm9yUHJvY2Vzc29yKToKICAgZGVmIGh0dHBfcmVzcG9uc2Uoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgcmV0dXJuIHJlc3BvbnNlCiAgIGh0dHBzX3Jlc3BvbnNlID0gaHR0cF9yZXNwb25zZQogICAgICAgCmFkZG9uID0gX0VkaXQuYWRkb24KYWRkb25fdmVyc2lvbiA9IGFkZG9uLmdldEFkZG9uSW5mbygndmVyc2lvbicpCnByb2ZpbGUgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgoYWRkb24uZ2V0QWRkb25JbmZvKCdwcm9maWxlJykuZGVjb2RlKCd1dGYtOCcpKQpob21lID0geGJtYy50cmFuc2xhdGVQYXRoKGFkZG9uLmdldEFkZG9uSW5mbygncGF0aCcpLmRlY29kZSgndXRmLTgnKSkKZmF2b3JpdGVzID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdmYXZvcml0ZXMnKQpoaXN0b3J5ID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdoaXN0b3J5JykKClJFViA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnbGlzdF9yZXZpc2lvbicpCmljb24gPSBvcy5wYXRoLmpvaW4oaG9tZSwgJ2ljb24ucG5nJykKRkFOQVJUID0gb3MucGF0aC5qb2luKGhvbWUsICdmYW5hcnQuanBnJykKc291cmNlX2ZpbGUgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3NvdXJjZV9maWxlJykKZnVuY3Rpb25zX2RpciA9IHByb2ZpbGUKZGVidWcgPSBhZGRvbi5nZXRTZXR0aW5nKCdkZWJ1ZycpCmlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyk9PVRydWU6CiAgICBGQVYgPSBvcGVuKGZhdm9yaXRlcykucmVhZCgpCmVsc2U6IEZBViA9IFtdCmlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09VHJ1ZToKICAgIFNPVVJDRVMgPSBvcGVuKHNvdXJjZV9maWxlKS5yZWFkKCkKZWxzZTogU09VUkNFUyA9IFtdCgoKZGVmIGFkZG9uX2xvZyhzdHJpbmcpOgogICAgaWYgZGVidWcgPT0gJ3RydWUnOgogICAgICAgIHhibWMubG9nKCJbYWRkb24ubGl2ZS5EZWphVnUgTGlzdHMtJXNdOiAlcyIgJShhZGRvbl92ZXJzaW9uLCBzdHJpbmcpKQoKCmRlZiBtYWtlUmVxdWVzdCh1cmwsIGhlYWRlcnM9Tm9uZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBoZWFkZXJzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBoZWFkZXJzID0geydVc2VyLWFnZW50JyA6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFdPVzY0OyBydjoxOS4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE5LjAnfQogICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsLE5vbmUsaGVhZGVycykKICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgICAgICAgICBkYXRhID0gcmVzcG9uc2UucmVhZCgpCiAgICAgICAgICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICBleGNlcHQgdXJsbGliMi5VUkxFcnJvciwgZToKICAgICAgICAgICAgYWRkb25fbG9nKCdVUkw6ICcrdXJsKQogICAgICAgICAgICBpZiBoYXNhdHRyKGUsICdjb2RlJyk6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1dlIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgLSAlcy4nICUgZS5jb2RlKQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRGVqYVZ1LFdlIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgLSAiK3N0cihlLmNvZGUpKyIsMTAwMDAsIitpY29uKyIpIikKICAgICAgICAgICAgZWxpZiBoYXNhdHRyKGUsICdyZWFzb24nKToKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnV2UgZmFpbGVkIHRvIHJlYWNoIGEgc2VydmVyLicpCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1JlYXNvbjogJXMnICVlLnJlYXNvbikKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKERlamFWdSxXZSBmYWlsZWQgdG8gcmVhY2ggYSBzZXJ2ZXIuIC0gIitzdHIoZS5yZWFzb24pKyIsMTAwMDAsIitpY29uKyIpIikKCgkJCQkKZGVmIFNLaW5kZXgoKToKICAgIGFkZG9uX2xvZygiU0tpbmRleCIpCiAgICBnZXREYXRhKF9FZGl0Lk1haW5CYXNlLCcnKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoJCQpkZWYgT3Blbl9VcmwodXJsKToKICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdCh1cmwpCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsICdNb3ppbGxhLzUuMCAoV2luZG93czsgVTsgV2luZG93cyBOVCA1LjE7IGVuLUdCOyBydjoxLjkuMC4zKSBHZWNrby8yMDA4MDkyNDE3IEZpcmVmb3gvMy4wLjMnKQogICAgcmVzcG9uc2UgPSAnJwogICAgbGluayA9ICcnCiAgICB0cnk6IAogICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkKICAgICAgICBsaW5rPXJlc3BvbnNlLnJlYWQoKQogICAgICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgIGV4Y2VwdDogcGFzcwogICAgaWYgbGluayAhPSAnJzoKICAgICAgICByZXR1cm4gbGluawogICAgZWxzZToKICAgICAgICBsaW5rID0gJ09wZW5lZCcKICAgICAgICByZXR1cm4gbGluawoJCmRlZiBTZWFyY2hfaW5wdXQodXJsKToKICAgIERpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkKICAgIFNlYXJjaF90aXRsZSA9IERpYWxvZy5pbnB1dCgnU2VhcmNoJywgdHlwZT14Ym1jZ3VpLklOUFVUX0FMUEhBTlVNKQogICAgU2VhcmNoX25hbWUgPSBTZWFyY2hfdGl0bGUubG93ZXIoKQogICAgaWYgU2VhcmNoX25hbWUgPT0gJyc6CiAgICAgICAgcGFzcwogICAgZWxzZToKICAgICAgICBTZWFyY2hfbG9vcChTZWFyY2hfbmFtZSx1cmwpICAgIAoJCmRlZiBTZWFyY2hfbG9vcChTZWFyY2hfbmFtZSx1cmwpOgogICAgSFRNTCA9IE9wZW5fVXJsKHVybCkKICAgIGlmIEhUTUwgIT0gJ0ZhaWxlZCc6CiAgICAgICAgbWF0Y2ggPSByZS5jb21waWxlKCc8Y2hhbm5lbD4uKz88bmFtZT4oLis/KTwvbmFtZT4uKz88dGh1bWJuYWlsPiguKz8pPC90aHVtYm5haWw+Lis/PGV4dGVybmFsbGluaz4oLis/KTwvZXh0ZXJuYWxsaW5rPi4rPzxmYW5hcnQ+KC4rPyk8L2ZhbmFydD4uKz88L2NoYW5uZWw+JyxyZS5ET1RBTEwpLmZpbmRhbGwoSFRNTCkKICAgICAgICBmb3IgbmFtZSxpbWFnZSx1cmwsZmFuYXJ0IGluIG1hdGNoOgogICAgICAgICAgICBpZiBub3QgJ2h0dHA6JyBpbiB1cmw6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBTZWFyY2hfbG9vcChTZWFyY2hfbmFtZSx1cmwpCiAgICAgICAgbWF0Y2gyID0gcmUuY29tcGlsZSgnPHRpdGxlPiguKz8pPC90aXRsZT4uKz88bGluaz4oLis/KTwvbGluaz4uKz88dGh1bWJuYWlsPiguKz8pPC90aHVtYm5haWw+Lis/PGZhbmFydD4oLis/KTwvZmFuYXJ0PicscmUuRE9UQUxMKS5maW5kYWxsKEhUTUwpCiAgICAgICAgZm9yIG5hbWUsdXJsLGltYWdlLGZhbmFydCBpbiBtYXRjaDI6CiAgICAgICAgICAgIGlmICdodHRwOicgaW4gdXJsOgogICAgICAgICAgICAgICAgaWYgU2VhcmNoX25hbWUubG93ZXIoKSBpbiBuYW1lLmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgYWRkTGluayh1cmwsIG5hbWUsaW1hZ2UsZmFuYXJ0LCcnLCcnLCcnLCcnLE5vbmUsJycsMSkKCQkKCQkKZGVmIGdldFNvdXJjZXMoKToKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpID09IFRydWU6CiAgICAgICAgICAgIGFkZERpcignRmF2b3JpdGVzJywndXJsJyw0LG9zLnBhdGguam9pbihob21lLCAncmVzb3VyY2VzJywgJ2Zhdm9yaXRlLnBuZycpLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJicm93c2VfeG1sX2RhdGFiYXNlIikgPT0gInRydWUiOgogICAgICAgICAgICBhZGREaXIoJ1hNTCBEYXRhYmFzZScsJ2h0dHA6Ly94Ym1jcGx1cy54Yi5mdW5waWMuZGUvd3d3LWRhdGEvZmlsZXN5c3RlbS8nLDE1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoImJyb3dzZV9jb21tdW5pdHkiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgIGFkZERpcignQ29tbXVuaXR5IEZpbGVzJywnY29tbXVuaXR5X2ZpbGVzJywxNixpY29uLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhoaXN0b3J5KSA9PSBUcnVlOgogICAgICAgICAgICBhZGREaXIoJ1NlYXJjaCBIaXN0b3J5JywnaGlzdG9yeScsMjUsb3MucGF0aC5qb2luKGhvbWUsICdyZXNvdXJjZXMnLCAnZmF2b3JpdGUucG5nJyksRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoInNlYXJjaHl0IikgPT0gInRydWUiOgogICAgICAgICAgICBhZGREaXIoJ1NlYXJjaDpZb3V0dWJlJywneW91dHViZScsMjUsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygic2VhcmNoRE0iKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgIGFkZERpcignU2VhcmNoOmRhaWx5bW90aW9uJywnZG1vdGlvbicsMjUsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygiUHVsc2FyTSIpID09ICJ0cnVlIjoKICAgICAgICAgICAgYWRkRGlyKCdQdWxzYXI6SU1EQicsJ0lNREJpZHBsYXknLDI3LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKSAgICAgICAgICAgIAogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09VHJ1ZToKICAgICAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkKICAgICAgICAgICAgI3ByaW50ICdzb3VyY2VzJyxzb3VyY2VzCiAgICAgICAgICAgIGlmIGxlbihzb3VyY2VzKSA+IDE6CiAgICAgICAgICAgICAgICBmb3IgaSBpbiBzb3VyY2VzOgogICAgICAgICAgICAgICAgICAgICMjIGZvciBwcmUgMS4wLjggc291cmNlcwogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoaSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihpWzBdLmVuY29kZSgndXRmLTgnKSxpWzFdLmVuY29kZSgndXRmLTgnKSwxLGljb24sRkFOQVJULCcnLCcnLCcnLCcnLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iID0gaWNvbgogICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBGQU5BUlQKICAgICAgICAgICAgICAgICAgICAgICAgZGVzYyA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ3RodW1ibmFpbCcpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpWyd0aHVtYm5haWwnXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2ZhbmFydCcpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gaVsnZmFuYXJ0J10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdkZXNjcmlwdGlvbicpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGlbJ2Rlc2NyaXB0aW9uJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdkYXRlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gaVsnZGF0ZSddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZ2VucmUnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbnJlID0gaVsnZ2VucmUnXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2NyZWRpdHMnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBpWydjcmVkaXRzJ10KICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKGlbJ3RpdGxlJ10uZW5jb2RlKCd1dGYtOCcpLGlbJ3VybCddLmVuY29kZSgndXRmLTgnKSwxLHRodW1iLGZhbmFydCxkZXNjLGdlbnJlLGRhdGUsY3JlZGl0cywnc291cmNlJykKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBsZW4oc291cmNlcykgPT0gMToKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNvdXJjZXNbMF0sIGxpc3QpOgogICAgICAgICAgICAgICAgICAgICAgICBnZXREYXRhKHNvdXJjZXNbMF1bMV0uZW5jb2RlKCd1dGYtOCcpLEZBTkFSVCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBnZXREYXRhKHNvdXJjZXNbMF1bJ3VybCddLCBzb3VyY2VzWzBdWydmYW5hcnQnXSkKCgpkZWYgYWRkU291cmNlKHVybD1Ob25lKToKICAgICAgICBpZiB1cmwgaXMgTm9uZToKICAgICAgICAgICAgaWYgbm90IGFkZG9uLmdldFNldHRpbmcoIm5ld19maWxlX3NvdXJjZSIpID09ICIiOgogICAgICAgICAgICAgICBzb3VyY2VfdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbmV3X2ZpbGVfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpCiAgICAgICAgICAgIGVsaWYgbm90IGFkZG9uLmdldFNldHRpbmcoIm5ld191cmxfc291cmNlIikgPT0gIiI6CiAgICAgICAgICAgICAgIHNvdXJjZV91cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCduZXdfdXJsX3NvdXJjZScpLmRlY29kZSgndXRmLTgnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNvdXJjZV91cmwgPSB1cmwKICAgICAgICBpZiBzb3VyY2VfdXJsID09ICcnIG9yIHNvdXJjZV91cmwgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgYWRkb25fbG9nKCdBZGRpbmcgTmV3IFNvdXJjZTogJytzb3VyY2VfdXJsLmVuY29kZSgndXRmLTgnKSkKCiAgICAgICAgbWVkaWFfaW5mbyA9IE5vbmUKICAgICAgICAjcHJpbnQgJ3NvdXJjZV91cmwnLHNvdXJjZV91cmwKICAgICAgICBkYXRhID0gZ2V0U291cChzb3VyY2VfdXJsKQogICAgICAgIHByaW50ICdzb3VyY2VfdXJsJyxzb3VyY2VfdXJsCiAgICAgICAgaWYgaXNpbnN0YW5jZShkYXRhLEJlYXV0aWZ1bFNPQVApOgogICAgICAgICAgICBpZiBkYXRhLmZpbmQoJ2NoYW5uZWxzX2luZm8nKToKICAgICAgICAgICAgICAgIG1lZGlhX2luZm8gPSBkYXRhLmNoYW5uZWxzX2luZm8KICAgICAgICAgICAgZWxpZiBkYXRhLmZpbmQoJ2l0ZW1zX2luZm8nKToKICAgICAgICAgICAgICAgIG1lZGlhX2luZm8gPSBkYXRhLml0ZW1zX2luZm8KICAgICAgICBpZiBtZWRpYV9pbmZvOgogICAgICAgICAgICBzb3VyY2VfbWVkaWEgPSB7fQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3VybCddID0gc291cmNlX3VybAogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsndGl0bGUnXSA9IG1lZGlhX2luZm8udGl0bGUuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsndGh1bWJuYWlsJ10gPSBtZWRpYV9pbmZvLnRodW1ibmFpbC5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydmYW5hcnQnXSA9IG1lZGlhX2luZm8uZmFuYXJ0LnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2dlbnJlJ10gPSBtZWRpYV9pbmZvLmdlbnJlLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2Rlc2NyaXB0aW9uJ10gPSBtZWRpYV9pbmZvLmRlc2NyaXB0aW9uLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2RhdGUnXSA9IG1lZGlhX2luZm8uZGF0ZS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydjcmVkaXRzJ10gPSBtZWRpYV9pbmZvLmNyZWRpdHMuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmICcvJyBpbiBzb3VyY2VfdXJsOgogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHNvdXJjZV91cmwuc3BsaXQoJy8nKVstMV0uc3BsaXQoJy4nKVswXQogICAgICAgICAgICBpZiAnXFwnIGluIHNvdXJjZV91cmw6CiAgICAgICAgICAgICAgICBuYW1lU3RyID0gc291cmNlX3VybC5zcGxpdCgnXFwnKVstMV0uc3BsaXQoJy4nKVswXQogICAgICAgICAgICBpZiAnJScgaW4gbmFtZVN0cjoKICAgICAgICAgICAgICAgIG5hbWVTdHIgPSB1cmxsaWIudW5xdW90ZV9wbHVzKG5hbWVTdHIpCiAgICAgICAgICAgIGtleWJvYXJkID0geGJtYy5LZXlib2FyZChuYW1lU3RyLCdEaXNwbGF5ZWQgTmFtZSwgUmVuYW1lPycpCiAgICAgICAgICAgIGtleWJvYXJkLmRvTW9kYWwoKQogICAgICAgICAgICBpZiAoa2V5Ym9hcmQuaXNDb25maXJtZWQoKSA9PSBGYWxzZSk6CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgbmV3U3RyID0ga2V5Ym9hcmQuZ2V0VGV4dCgpCiAgICAgICAgICAgIGlmIGxlbihuZXdTdHIpID09IDA6CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgc291cmNlX21lZGlhID0ge30KICAgICAgICAgICAgc291cmNlX21lZGlhWyd0aXRsZSddID0gbmV3U3RyCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsnZmFuYXJ0J10gPSBmYW5hcnQKCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1GYWxzZToKICAgICAgICAgICAgc291cmNlX2xpc3QgPSBbXQogICAgICAgICAgICBzb3VyY2VfbGlzdC5hcHBlbmQoc291cmNlX21lZGlhKQogICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VfbGlzdCkpCiAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNvdXJjZXMgPSBqc29uLmxvYWRzKG9wZW4oc291cmNlX2ZpbGUsInIiKS5yZWFkKCkpCiAgICAgICAgICAgIHNvdXJjZXMuYXBwZW5kKHNvdXJjZV9tZWRpYSkKICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlcykpCiAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ25ld191cmxfc291cmNlJywgIiIpCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygnbmV3X2ZpbGVfc291cmNlJywgIiIpCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRGVqYVZ1LE5ldyBzb3VyY2UgYWRkZWQuLDUwMDAsIitpY29uKyIpIikKICAgICAgICBpZiBub3QgdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIGlmICd4Ym1jcGx1cy54Yi5mdW5waWMuZGUnIGluIHVybDoKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlVwZGF0ZSglcz9tb2RlPTE0LHJlcGxhY2UpIiAlc3lzLmFyZ3ZbMF0pCiAgICAgICAgICAgIGVsaWYgJ2NvbW11bml0eS1saW5rcycgaW4gdXJsOgogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuVXBkYXRlKCVzP21vZGU9MTAscmVwbGFjZSkiICVzeXMuYXJndlswXSkKICAgICAgICBlbHNlOiBhZGRvbi5vcGVuU2V0dGluZ3MoKQoJCgpkZWYgcm1Tb3VyY2UobmFtZSk6CiAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkKICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UobGVuKHNvdXJjZXMpKToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzb3VyY2VzW2luZGV4XSwgbGlzdCk6CiAgICAgICAgICAgICAgICBpZiBzb3VyY2VzW2luZGV4XVswXSA9PSBuYW1lOgogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQogICAgICAgICAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlcykpCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWyd0aXRsZSddID09IG5hbWU6CiAgICAgICAgICAgICAgICAgICAgZGVsIHNvdXJjZXNbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkKICAgICAgICAgICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlJlZnJlc2giKQoKCgpkZWYgZ2V0X3htbF9kYXRhYmFzZSh1cmwsIGJyb3dzZT1GYWxzZSk6CiAgICAgICAgaWYgdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIHVybCA9ICdodHRwOi8veGJtY3BsdXMueGIuZnVucGljLmRlL3d3dy1kYXRhL2ZpbGVzeXN0ZW0vJwogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKG1ha2VSZXF1ZXN0KHVybCksIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTb3VwLkhUTUxfRU5USVRJRVMpCiAgICAgICAgZm9yIGkgaW4gc291cCgnYScpOgogICAgICAgICAgICBocmVmID0gaVsnaHJlZiddCiAgICAgICAgICAgIGlmIG5vdCBocmVmLnN0YXJ0c3dpdGgoJz8nKToKICAgICAgICAgICAgICAgIG5hbWUgPSBpLnN0cmluZwogICAgICAgICAgICAgICAgaWYgbmFtZSBub3QgaW4gWydQYXJlbnQgRGlyZWN0b3J5JywgJ3JlY3ljbGVfYmluLyddOgogICAgICAgICAgICAgICAgICAgIGlmIGhyZWYuZW5kc3dpdGgoJy8nKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnJvd3NlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTUsaWNvbixmYW5hcnQsJycsJycsJycpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxNCxpY29uLGZhbmFydCwnJywnJywnJykKICAgICAgICAgICAgICAgICAgICBlbGlmIGhyZWYuZW5kc3dpdGgoJy54bWwnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnJvd3NlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5hbWUgaW4gU09VUkNFUzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUrJyAoaW4gdXNlKScsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQoKCmRlZiBnZXRDb21tdW5pdHlTb3VyY2VzKGJyb3dzZT1GYWxzZSk6CiAgICAgICAgdXJsID0gJ2h0dHA6Ly9jb21tdW5pdHktbGlua3MuZ29vZ2xlY29kZS5jb20vc3ZuL3RydW5rLycKICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChtYWtlUmVxdWVzdCh1cmwpLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU291cC5IVE1MX0VOVElUSUVTKQogICAgICAgIGZpbGVzID0gc291cCgndWwnKVswXSgnbGknKVsxOl0KICAgICAgICBmb3IgaSBpbiBmaWxlczoKICAgICAgICAgICAgbmFtZSA9IGkoJ2EnKVswXVsnaHJlZiddCiAgICAgICAgICAgIGlmIGJyb3dzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtuYW1lLDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtuYW1lLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCgoKZGVmIGdldFNvdXAodXJsLGRhdGE9Tm9uZSk6CiAgICAgICAgcHJpbnQgJ2dldHNvdXAnLHVybCxkYXRhCiAgICAgICAgaWYgdXJsLnN0YXJ0c3dpdGgoJ2h0dHA6Ly8nKSBvciB1cmwuc3RhcnRzd2l0aCgnaHR0cHM6Ly8nKToKICAgICAgICAgICAgZGF0YSA9IG1ha2VSZXF1ZXN0KHVybCkKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCIjRVhUTTNVIixkYXRhKSBvciAnbTN1JyBpbiB1cmw6IAogICAgICAgICAgICAgICAgcHJpbnQgJ2ZvdW5kIG0zdSBkYXRhJyxkYXRhCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgICAgICAgICAgCiAgICAgICAgZWxpZiBkYXRhID09IE5vbmU6CiAgICAgICAgICAgIGlmIHhibWN2ZnMuZXhpc3RzKHVybCk6CiAgICAgICAgICAgICAgICBpZiB1cmwuc3RhcnRzd2l0aCgic21iOi8vIikgb3IgdXJsLnN0YXJ0c3dpdGgoIm5mczovLyIpOgogICAgICAgICAgICAgICAgICAgIGNvcHkgPSB4Ym1jdmZzLmNvcHkodXJsLCBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSkKICAgICAgICAgICAgICAgICAgICBpZiBjb3B5OgogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gb3Blbihvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSwgInIiKS5yZWFkKCkKICAgICAgICAgICAgICAgICAgICAgICAgeGJtY3Zmcy5kZWxldGUob3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JykpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJmYWlsZWQgdG8gY29weSBmcm9tIHNtYjoiKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBkYXRhID0gb3Blbih1cmwsICdyJykucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgaWYgcmUubWF0Y2goIiNFWFRNM1UiLGRhdGEpb3IgJ20zdScgaW4gdXJsOiAKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2ZvdW5kIG0zdSBkYXRhJyxkYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlNvdXAgRGF0YSBub3QgZm91bmQhIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgIHJldHVybiBCZWF1dGlmdWxTT0FQKGRhdGEsIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTdG9uZVNvdXAuWE1MX0VOVElUSUVTKQoKCmRlZiBnZXREYXRhKHVybCxmYW5hcnQpOgogICAgcHJpbnQgJ3VybC1nZXREYXRhJyx1cmwKICAgIFNldFZpZXdMYXlvdXQgPSAiTGlzdCIKICAgICAKICAgIHNvdXAgPSBnZXRTb3VwKHVybCkKICAgICNwcmludCB0eXBlKHNvdXApCiAgICBpZiBpc2luc3RhbmNlKHNvdXAsQmVhdXRpZnVsU09BUCk6CiAgICAgICAgaWYgbGVuKHNvdXAoJ2xheW91dHlwZScpKSA+IDA6CiAgICAgICAgICAgIFNldFZpZXdMYXlvdXQgPSAiVGh1bWJuYWlsIgkJICAgIAoKICAgICAgICBpZiBsZW4oc291cCgnY2hhbm5lbHMnKSkgPiAwOgogICAgICAgICAgICBjaGFubmVscyA9IHNvdXAoJ2NoYW5uZWwnKQogICAgICAgICAgICBmb3IgY2hhbm5lbCBpbiBjaGFubmVsczoKIyAgICAgICAgICAgICAgICBwcmludCBjaGFubmVsCgogICAgICAgICAgICAgICAgbGlua2VkVXJsPScnCiAgICAgICAgICAgICAgICBsY291bnQ9MAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGxpbmtlZFVybCA9ICBjaGFubmVsKCdleHRlcm5hbGxpbmsnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBsY291bnQ9bGVuKGNoYW5uZWwoJ2V4dGVybmFsbGluaycpKQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgICAgICAjcHJpbnQgJ2xpbmtlZFVybCcsbGlua2VkVXJsLGxjb3VudAogICAgICAgICAgICAgICAgaWYgbGNvdW50PjE6IGxpbmtlZFVybD0nJwoKICAgICAgICAgICAgICAgIG5hbWUgPSBjaGFubmVsKCduYW1lJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBjaGFubmVsKCd0aHVtYm5haWwnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjaGFubmVsKCdmYW5hcnQnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsKCdmYW5hcnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGNoYW5uZWwoJ2luZm8nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZGVzYyA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGdlbnJlID0gY2hhbm5lbCgnZ2VucmUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGdlbnJlID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGNoYW5uZWwoJ2RhdGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBjaGFubmVsKCdjcmVkaXRzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBsaW5rZWRVcmw9PScnOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHVybC5lbmNvZGUoJ3V0Zi04JyksMix0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLFRydWUpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmFtZSA9PSAnW0NPTE9SIHJlZF1MaXZlIFNwb3J0Wy9DT0xPUl0nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLGxpbmtlZFVybC5lbmNvZGUoJ3V0Zi04JyksMzEsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkJCQkJICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxsaW5rZWRVcmwuZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGRpcmVjdG9yeSBmcm9tIGdldERhdGEoKTogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCdObyBDaGFubmVsczogZ2V0SXRlbXMnKQogICAgICAgICAgICBnZXRJdGVtcyhzb3VwKCdpdGVtJyksZmFuYXJ0KQogICAgZWxzZToKICAgICAgICBwYXJzZV9tM3Uoc291cCkKCiAgICBpZiBTZXRWaWV3TGF5b3V0ID09ICJUaHVtYm5haWwiOgogICAgICAgU2V0Vmlld1RodW1ibmFpbCgpCgkgICAKZGVmIFdpekhETWVudSh1cmwsaWNvbmltYWdlLGZhbmFydCk6CglhZGREaXIoJ0RlamFWdVBsYXlsaXN0ZWQnLHVybCwxLGljb25pbWFnZSxmYW5hcnQsJycsJycsJycsTm9uZSwnc291cmNlJykKCWh0bWwgPSByZXF1ZXN0cy5nZXQoJ2h0dHA6Ly93aXpoZHNwb3J0cy5pcy8nKS5jb250ZW50CglibG9jayA9IHJlLmNvbXBpbGUoJzx1bCBjbGFzcz0ic3BvcnRzX21lbnUiPiguKz8pPC91bD4nLHJlLkRPVEFMTCkuZmluZGFsbChodG1sKQoJZm9yIGl0ZW0gaW4gYmxvY2s6CgkJbWF0Y2ggPSByZS5jb21waWxlKCc8YSBocmVmPSIoLis/KSIuKz9zcmM9IiguKz8pIi4rPz4gKC4rPyk8L2xpPicpLmZpbmRhbGwoc3RyKGl0ZW0pKQoJCWZvciB1cmwyLGljb25pbWFnZSxuYW1lIGluIG1hdGNoOgoJCQluYW1lID0gbmFtZS50aXRsZSgpCgkJCWlmIG5hbWUgPT0gJ05mbCc6aW1hZ2UgPSBOZmwKCQkJZWxpZiBuYW1lID09ICdGb290YmFsbCc6aW1hZ2UgPSBGb290YmFsbAoJCQllbGlmIG5hbWUgPT0gJ0NyaWNrZXQnOmltYWdlID0gQ3JpY2tldAoJCQllbGlmIG5hbWUgPT0gJ1Rlbm5pcyc6aW1hZ2UgPSBUZW5uaXMKCQkJZWxpZiBuYW1lID09ICdCb3hpbmcnOmltYWdlID0gQm94aW5nCgkJCWVsaWYgbmFtZSA9PSAnR29sZic6aW1hZ2UgPSBHb2xmCgkJCWVsaWYgbmFtZSA9PSAnTW90b3Nwb3J0cyc6aW1hZ2UgPSBNb3RvcnNwb3J0cwoJCQllbGlmIG5hbWUgPT0gJ1J1Z2J5JzppbWFnZSA9IFJ1Z2J5CgkJCWVsaWYgbmFtZSA9PSAnSG9ja2V5JzppbWFnZSA9IEhvY2tleQoJCQllbGlmIG5hbWUgPT0gJ05iYSc6aW1hZ2UgPSBOYmEKCQkJZWxpZiBuYW1lID09ICdEYXJ0cyc6aW1hZ2UgPSBEYXJ0cwoJCQllbGlmIG5hbWUgPT0gJ1d3ZSc6aW1hZ2UgPSBXd2UKCQkJZWxpZiBuYW1lID09ICdIb3JzZSBSYWNpbmcnOmltYWdlID0gSG9yc2VfUmFjaW5nCgkJCWVsaWYgbmFtZSA9PSAnVWZjJzppbWFnZSA9IFVmYwoJCQllbGlmIG5hbWUgPT0gJ0Jhc2ViYWxsJzppbWFnZSA9IEJhc2ViYWxsCgkJCWlmIG5hbWUgPT0gJ1R2IFNob3dzJzpwYXNzCgkJCWVsaWYgbmFtZSA9PSAnT3RoZXJzJzpwYXNzCgkJCWVsaWYgbmFtZSA9PSAnUDJQIE9ubGluZSc6cGFzcwoJCQllbHNlOgoJCQkJaWYgaW1hZ2UgPT0gJyc6CgkJCQkJaW1hZ2UgPSBpY29uaW1hZ2UKCQkJCWFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSx1cmwyLmVuY29kZSgndXRmLTgnKSwzMixpbWFnZSxmYW5hcnQsJycsJycsJycsTm9uZSwnc291cmNlJykKCQkJCQpkZWYgV2l6X0dldF91cmwodXJsKToKCUxpc3QgPSBbXQoKCWZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCgl0b2RheXNfZGF5ID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkJykKCXRvZGF5c19tb250aCA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclbScpCgl0b2RheXNfeWVhciA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclWScpCgl0b2RheXNfaG91ciA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSCcpCgl0b2RheXNfbWludXRlID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVNJykKCWZpbl9kYXRlID0gdG9kYXlzX2RheSsnLScrdG9kYXlzX21vbnRoKyctJyt0b2RheXNfeWVhcgoJaHRtbCA9IHJlcXVlc3RzLmdldCh1cmwpLmNvbnRlbnQKCWJsb2NrID0gcmUuY29tcGlsZSgnPGgzPi4rP0dhbWVzIE9uIDogKC4rPyk8L2gzPiguKz8pPGxpIGNsYXNzPVwnc3BvcnRzX3JlZF9iYXJcJz4nLHJlLkRPVEFMTCkuZmluZGFsbChodG1sKQoJZm9yIGRhdGUscmVzdCBpbiBibG9jazoKCQlpZiBkYXRlID09IGZpbl9kYXRlOgoJCQltYXRjaCA9IHJlLmNvbXBpbGUoJzxkaXYgY2xhc3M9XCdjb2wtbWQtMlwnPi4rPzwvc3Bhbj4oLis/KTwvZGl2Pi4rPzxkaXYgY2xhc3M9XCdjb2wtbWQtNlwnPiguKz8pPC9kaXY+Lis/ZGl2IGNsYXNzPSJjYXJkLWJsb2NrIGRyb3BfYm94Ij4oLis/KTxkaXYgY2xhc3M9ImNhcmQiPicscmUuRE9UQUxMKS5maW5kYWxsKHN0cihyZXN0KSkKCQkJZm9yIHRpbWUsdGVhbXMsbGlua19ibG9jayBpbiBtYXRjaDoKCQkJCXRvdGFsID0gbGVuKG1hdGNoKQoJCQkJdGVhbXMgPSB0ZWFtcy5yZXBsYWNlKCcgICcsJycpLnJlcGxhY2UoJwknLCcnKQoJCQkJbGlua19ibG9jayA9IGxpbmtfYmxvY2sucmVwbGFjZSgnICAnLCcnKQoJCQkJdGltZV9zcGxpdCA9IHJlLmZpbmRhbGwoJyguKz8pOiguKz8pLSguKz8pOiguKz8pPicsc3RyKHRpbWUrJz4nKSkKCQkJCWZvciBzdGFydF9ob3VyLHN0YXJ0X21pbixmaW5faG91cixmaW5fbWluIGluIHRpbWVfc3BsaXQ6CgkJCQkJc3RhcnRfbm8gPSBpbnQoc3RhcnRfaG91cikqMjQraW50KHN0YXJ0X21pbikKCQkJCQlmaW5fbm8gPSBpbnQoZmluX2hvdXIpKjI0K2ludChmaW5fbWluKQoJCQkJCXRpbWVfbm93ID0gaW50KHRvZGF5c19ob3VyKSoyNCtpbnQodG9kYXlzX21pbnV0ZSkKCQkJCQlpZiBmaW5fbm8+dGltZV9ub3c+c3RhcnRfbm86CgkJCQkJCW5hbWUgPSAnW0NPTE9SZ3JlZW5dJysgdGVhbXMrJ1svQ09MT1JdJwoJCQkJCWVsc2U6CgkJCQkJCW5hbWUgPSB0ZWFtcwoJCQkJbGlua19nZXQgPSByZS5jb21waWxlKCI8YSBocmVmPScoLis/KSc+Lis/PiguKz8pPC9kaXY+PC9hPiIpLmZpbmRhbGwoc3RyKGxpbmtfYmxvY2spKQoJCQkJZm9yIGxpbmssY2hubCBpbiBsaW5rX2dldDoKCQkJCQlsaW5rID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5TcG9ydHNEZXZpbC8/bW9kZT0xJmFtcDtpdGVtPWNhdGNoZXIlM2RzdHJlYW1zJTI2dXJsPScrbGluawoJCQkJCWlmIGxlbihsaW5rX2dldCk+MToKCQkJCQkJTGlzdC5hcHBlbmQoKGxpbmssY2hubCkpCgkJCQkJZWxzZToKCQkJCQkJYWRkTGluayhsaW5rLHRpbWUucmVwbGFjZSgnICcsJycpKyctJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksaWNvbixGQU5BUlQsJycsJycsJycsVHJ1ZSxOb25lLHJlZ2V4cyx0b3RhbCkJCQkJCQkKCQkJCWlmIGxlbihMaXN0KT4xOgoJCQkJCXZ1cmwgPSBzdHIoTGlzdCkucmVwbGFjZSgnWycsJ3N1YmxpbmsnKS5yZXBsYWNlKCddJywnIycpLnJlcGxhY2UoJ3N1YmxpbmsoXCcnLCdzdWJsaW5rOicpLnJlcGxhY2UoJ3BsdWdpbjonLCdMSVNUU09VUkNFOnBsdWdpbjonKS5yZXBsYWNlKCInLCAnIiwnOjpMSVNUTkFNRTonKS5yZXBsYWNlKCInKSwgKCciLCc6OiNzdWJsaW5rJykucmVwbGFjZSgiJykiLCcnKS5yZXBsYWNlKCdzdWJsaW5rTElTVFNPVVJDRScsJ3N1Ymxpbms6TElTVFNPVVJDRScpCgkJCQkJeGJtYy5sb2codnVybCkKCQkJCQlhZGREaXIodGltZS5yZXBsYWNlKCcgJywnJykrJy0nK25hbWUsdnVybCwzMCxpY29uLEZBTkFSVCwnJywnJywnJywnJykKCQkJCQlkZWwgTGlzdFs6XQoJCQoKCgkKCiMgYm9ycm93IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2VuZW45Mi9QMlAtU3RyZWFtcy1YQk1DL2Jsb2IvbWFzdGVyL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy9yZXNvdXJjZXMvY29yZS9saXZlc3RyZWFtcy5weQojIFRoaXMgd2lsbCBub3QgZ28gdGhyb3VnaCB0aGUgZ2V0SXRlbXMgZnVuY3Rpb25zICggbWVhbnMgeW91IG11c3QgaGF2ZSByZWFkeSB0byBwbGF5IHVybCwgbm8gcmVnZXgpCmRlZiBwYXJzZV9tM3UoZGF0YSk6CiAgICBjb250ZW50ID0gZGF0YS5yc3RyaXAoKQogICAgbWF0Y2ggPSByZS5jb21waWxlKHInI0VYVElORjooLis/KSwoLio/KVtcblxyXSsoW15cbl0rKScpLmZpbmRhbGwoY29udGVudCkKICAgIHRvdGFsID0gbGVuKG1hdGNoKQogICAgcHJpbnQgJ3RvdGFsIG0zdSBsaW5rcycsdG90YWwKICAgIGZvciBvdGhlcixjaGFubmVsX25hbWUsc3RyZWFtX3VybCBpbiBtYXRjaDoKICAgICAgICBpZiAndHZnLWxvZ28nIGluIG90aGVyOgogICAgICAgICAgICB0aHVtYm5haWwgPSByZV9tZShvdGhlciwndHZnLWxvZ289W1wnIl0oLio/KVtcJyJdJykKICAgICAgICAgICAgaWYgdGh1bWJuYWlsOgogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykgPT0gIiI6CiAgICAgICAgICAgICAgICAgICAgbG9nb191cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGxvZ29fdXJsICsgdGh1bWJuYWlsCgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwKICAgICAgICAgICAgI2Vsc2U6CiAgICAgICAgICAgIAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCiAgICAgICAgaWYgJ3R5cGUnIGluIG90aGVyOgogICAgICAgICAgICBtb2RlX3R5cGUgPSByZV9tZShvdGhlciwndHlwZT1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiBtb2RlX3R5cGUgPT0gJ3l0LWRsJzoKICAgICAgICAgICAgICAgIHN0cmVhbV91cmwgPSBzdHJlYW1fdXJsICsiJm1vZGU9MTgiCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdyZWdleCc6CiAgICAgICAgICAgICAgICB1cmwgPSBzdHJlYW1fdXJsLnNwbGl0KCcmcmVnZXhzPScpCiAgICAgICAgICAgICAgICAjcHJpbnQgdXJsWzBdIGdldFNvdXAodXJsLGRhdGE9Tm9uZSkKICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KGdldFNvdXAoJycsZGF0YT11cmxbMV0pKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybFswXSwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgYWRkTGluayhzdHJlYW1fdXJsLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWwpCgkJCiAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTApIikKCQpkZWYgZ2V0Q2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCk6CiAgICAgICAgc291cCA9IGdldFNvdXAodXJsKQogICAgICAgIGNoYW5uZWxfbGlzdCA9IHNvdXAuZmluZCgnY2hhbm5lbCcsIGF0dHJzPXsnbmFtZScgOiBuYW1lLmRlY29kZSgndXRmLTgnKX0pCiAgICAgICAgaXRlbXMgPSBjaGFubmVsX2xpc3QoJ2l0ZW0nKQogICAgICAgIHRyeToKICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbF9saXN0KCdmYW5hcnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICByYWlzZQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbF9saXN0KCdzdWJjaGFubmVsJyk6CiAgICAgICAgICAgIG5hbWUgPSBjaGFubmVsKCduYW1lJylbMF0uc3RyaW5nCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGNoYW5uZWwoJ3RodW1ibmFpbCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOgogICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWwoJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXNjID0gY2hhbm5lbCgnaW5mbycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRlc2MgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ2VucmUgPSBjaGFubmVsKCdnZW5yZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRhdGUgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY3JlZGl0cyA9IGNoYW5uZWwoJ2NyZWRpdHMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGNyZWRpdHMgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdXJsLmVuY29kZSgndXRmLTgnKSwzLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxjcmVkaXRzLGRhdGUpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnVGhlcmUgd2FzIGEgcHJvYmxlbSBhZGRpbmcgZGlyZWN0b3J5IC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiAgICAgICAgZ2V0SXRlbXMoaXRlbXMsZmFuQXJ0KQoKCmRlZiBnZXRTdWJDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KToKICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpCiAgICAgICAgY2hhbm5lbF9saXN0ID0gc291cC5maW5kKCdzdWJjaGFubmVsJywgYXR0cnM9eyduYW1lJyA6IG5hbWUuZGVjb2RlKCd1dGYtOCcpfSkKICAgICAgICBpdGVtcyA9IGNoYW5uZWxfbGlzdCgnc3ViaXRlbScpCiAgICAgICAgZ2V0SXRlbXMoaXRlbXMsZmFuYXJ0KQoKI2hha2FtYWMKZGVmIEdldFN1YmxpbmtzKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQpOgogICAgeGJtYy5sb2coJ0kgR09UIEhFUkUjIyMjIyMjIyMjIyMjIyMnKQogICAgTGlzdD1bXTsgTGlzdFU9W107IGM9MAogICAgYWxsX3ZpZGVvcyA9IHJlZ2V4X2dldF9hbGwodXJsLCAnc3VibGluazonLCAnIycpCiAgICBmb3IgYSBpbiBhbGxfdmlkZW9zOgogICAgICAgIGlmICdMSVNUU09VUkNFOicgaW4gYToKICAgICAgICAgICAgdnVybCA9IHJlZ2V4X2Zyb21fdG8oYSwgJ0xJU1RTT1VSQ0U6JywgJzo6JykKICAgICAgICAgICAgbGluZW5hbWUgPSByZWdleF9mcm9tX3RvKGEsICdMSVNUTkFNRTonLCAnOjonKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHZ1cmwgPSBhLnJlcGxhY2UoJ3N1Ymxpbms6JywnJykucmVwbGFjZSgnIycsJycpCiAgICAgICAgICAgIGxpbmVuYW1lID0gbmFtZQogICAgICAgIGlmIGxlbih2dXJsKSA+IDEwOgogICAgICAgICAgICBjPWMrMTsgTGlzdC5hcHBlbmQobGluZW5hbWUpOyBMaXN0VS5hcHBlbmQodnVybCkKIAogICAgaWYgYz09MToKICAgICAgICB0cnk6CiAgICAgICAgICAgICNwcmludCAncGxheSAxICAgTmFtZTonICsgbmFtZSArICcgICB1cmw6JyArIExpc3RVWzBdICsgJyAgICAgJyArIHN0cihjKQogICAgICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlLHRodW1ibmFpbEltYWdlPWljb25pbWFnZSk7IGxpei5zZXRJbmZvKCB0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lIH0gKQogICAgICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPUxpc3RVWzBdLGxpc3RpdGVtPWxpeikKICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihMaXN0VVswXSksIGxpeikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgIGVsc2U6CiAgICAgICAgIGRpYWxvZz14Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgIHJObz1kaWFsb2cuc2VsZWN0KCdEZWphVnVTZWxlY3QgQSBTb3VyY2UnLCBMaXN0KQogICAgICAgICBpZiByTm8+PTA6CiAgICAgICAgICAgICByTmFtZT1uYW1lCiAgICAgICAgICAgICByVVJMPXN0cihMaXN0VVtyTm9dKQogICAgICAgICAgICAgI3ByaW50ICdTdWJsaW5rcyAgIE5hbWU6JyArIG5hbWUgKyAnICAgdXJsOicgKyByVVJMCiAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihyVVJMKSwgeGJtY2d1aS5MaXN0SXRlbShyTmFtZSkpCiAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHJVUkwsIHhibWNndWkuTGlzdEl0ZW0ock5hbWUpKQoKCQkJCQpkZWYgU2VhcmNoQ2hhbm5lbHMoKToKI2hha2FtYWMgY29kZQogICAgS2V5Ym9hcmRNZXNzYWdlID0gJ05hbWUgb2YgY2hhbm5lbCBzaG93IG9yIG1vdmllJwogICAgU2VhcmNoa2V5ID0gJycKICAgIGtleWJvYXJkID0geGJtYy5LZXlib2FyZChTZWFyY2hrZXksIEtleWJvYXJkTWVzc2FnZSkKICAgIGtleWJvYXJkLmRvTW9kYWwoKQogICAgaWYga2V5Ym9hcmQuaXNDb25maXJtZWQoKToKICAgICAgIFNlYXJjaGtleSA9IGtleWJvYXJkLmdldFRleHQoKS5yZXBsYWNlKCdcbicsJycpLnN0cmlwKCkKICAgICAgIGlmIGxlbihTZWFyY2hrZXkpID09IDA6IAogICAgICAgICAgeGJtY2d1aS5EaWFsb2coKS5vaygnUm9iaW5Ib29kJywgJ05vdGhpbmcgRW50ZXJlZCcpCiAgICAgICAgICByZXR1cm4JICAgCiAgICAKICAgIFNlYXJjaGtleSA9IFNlYXJjaGtleS5sb3dlcigpCiAgICBMaXN0PVtdCiAgICBMaXN0LmFwcGVuZChfRWRpdC5NYWluQmFzZSkKICAgIFBhc3NlZFVybHMgPSAwCiAgICBGb3VuZENoYW5uZWwgPSAxIAogICAgUmVhZENoYW5uZWwgPSAwCiAgICBGb3VuZE1hdGNoID0gMAogICAgcHJvZ3Jlc3MgPSB4Ym1jZ3VpLkRpYWxvZ1Byb2dyZXNzKCkKICAgIHByb2dyZXNzLmNyZWF0ZSgnRGVqYVZ1U2VhcmNoaW5nIFBsZWFzZSB3YWl0JywnICcpCgkKICAgIHdoaWxlIEZvdW5kQ2hhbm5lbCA8PiBSZWFkQ2hhbm5lbDoKICAgICAgICBCYXNlU2VhcmNoID0gTGlzdFtSZWFkQ2hhbm5lbF0uc3RyaXAoKQogICAgICAgIHByaW50ICdyZWFkIHRoaXMgb25lIGZyb20gZmlsZSBsaXN0ICgnICsgc3RyKFJlYWRDaGFubmVsKSArICcpJyAgCiAgICAgICAgUmVhZENoYW5uZWwgPSBSZWFkQ2hhbm5lbCArIDEKCiAgICAgICAgUGFnZVNvdXJjZSA9ICcnCiAgICAgICAgdHJ5OgogICAgICAgICAgICBQYWdlU291cmNlID0gbmV0Lmh0dHBfR0VUKEJhc2VTZWFyY2gpLmNvbnRlbnQKICAgICAgICAgICAgUGFnZVNvdXJjZSA9IFBhZ2VTb3VyY2UuZW5jb2RlKCdhc2NpaScsICdpZ25vcmUnKS5kZWNvZGUoJ2FzY2lpJykKICAgICAgICAgICAgI3RpbWUuc2xlZXAoMSkKICAgICAgICBleGNlcHQ6IAogICAgICAgICAgICBwYXNzCgkJCiAgICAgICAgaWYgbGVuKFBhZ2VTb3VyY2UpIDwgMTA6CiAgICAgICAgICAgIFBhZ2VTb3VyY2UgPSAnJwogICAgICAgICAgICBQYXNzZWRVcmxzID0gUGFzc2VkVXJscyArIDEKICAgICAgICAgICAgcHJpbnQgJyoqKiBQQVNTRUQgKioqKicgKyBCYXNlU2VhcmNoICsgJyAgKioqKioqKioqKioqKiBUb3RhbCBQYXNzZWQgVXJsczogJyArIHN0cihQYXNzZWRVcmxzKQogICAgICAgICAgICB0aW1lLnNsZWVwKC41KQogCiAgICAgICAgcGVyY2VudCA9IGludCggKCBSZWFkQ2hhbm5lbCAvIDMwMCkgKiAxMDApIAogICAgICAgIG1lc3NhZ2UgPSAnICAgICBQYWdlcyBSZWFkOiAnK3N0cihSZWFkQ2hhbm5lbCkrJyAgICAgICAgTWF0Y2hlcyBGb3VuZDogJyArIHN0cihGb3VuZE1hdGNoKQogICAgICAgIHByb2dyZXNzLnVwZGF0ZShwZXJjZW50LCIiLCBtZXNzYWdlLCAiIiApCgogICAgICAgIGlmIHByb2dyZXNzLmlzY2FuY2VsZWQoKToKICAgICAgICAgICByZXR1cm4KIAkJCiAgICAgICAgaWYgbGVuKFBhZ2VTb3VyY2UpID4gMTA6CiAgICAgICAgICAgIGFsbF9saW5rcyA9IHJlZ2V4X2dldF9hbGwoUGFnZVNvdXJjZSwgJzxjaGFubmVsPicsICc8L2NoYW5uZWw+JykKICAgICAgICAgICAgZm9yIGEgaW4gYWxsX2xpbmtzOgogICAgICAgICAgICAgICAgdnVybCA9IHJlZ2V4X2Zyb21fdG8oYSwgJzxleHRlcm5hbGxpbms+JywgJzwvZXh0ZXJuYWxsaW5rPicpCiAgICAgICAgICAgICAgICAjbmFtZSA9IHJlZ2V4X2Zyb21fdG8oYSwgJzxuYW1lPicsICc8L25hbWU+JykKICAgICAgICAgICAgICAgICNwcmludCBuYW1lICsgJyAgICAnICsgdnVybAogICAgICAgICAgICAgICAgaWYgbGVuKHZ1cmwpID4gNToKICAgICAgICAgICAgICAgICAgIEZvdW5kQ2hhbm5lbCA9IEZvdW5kQ2hhbm5lbCArIDEKICAgICAgICAgICAgICAgICAgIExpc3QuYXBwZW5kKHZ1cmwpCiAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ0ZvdW5kIENoYW5uZWw6ICcrIHN0cihGb3VuZENoYW5uZWwpICsnIDogJysgdnVybCAKCiAgICAgICAgICAgIGFsbF9pdGVtcyA9IHJlZ2V4X2dldF9hbGwoUGFnZVNvdXJjZSwgJzxpdGVtPicsICc8L2l0ZW0+JykKICAgICAgICAgICAgZm9yIGEgaW4gYWxsX2l0ZW1zOgogICAgICAgICAgICAgICAgdnVybCA9IHJlZ2V4X2Zyb21fdG8oYSwgJzxsaW5rPicsICc8L2xpbms+JykKICAgICAgICAgICAgICAgIG5hbWUgPSByZWdleF9mcm9tX3RvKGEsICc8dGl0bGU+JywgJzwvdGl0bGU+JykKICAgICAgICAgICAgICAgIFRlc3ROYW1lID0gJyAgJyArIG5hbWUubG93ZXIoKSArICcgICcKICAgICAgICAgICAgICAgICNwcmludCAnVGVzdGluZzonICsgVGVzdE5hbWUgKyAnICAnICsgU2VhcmNoa2V5CiAgICAgICAgICAgICAgICBpZiBsZW4odnVybCkgPiA1IGFuZCBUZXN0TmFtZS5maW5kKFNlYXJjaGtleSkgPiAwOgogICAgICAgICAgICAgICAgICAgIEZvdW5kTWF0Y2ggPSBGb3VuZE1hdGNoICsgMQogICAgICAgICAgICAgICAgICAgIGZhbmFydCA9ICcnCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gcmVnZXhfZnJvbV90byhhLCAnPHRodW1ibmFpbD4nLCAnPC90aHVtYm5haWw+JykKICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSByZWdleF9mcm9tX3RvKGEsICc8ZmFuYXJ0PicsICc8L2ZhbmFydD4nKQogICAgICAgICAgICAgICAgICAgIGlmIGxlbihmYW5hcnQpIDwgNToKICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBpY29uCiAgICAgICAgICAgICAgICAgICAgaWYgdnVybC5maW5kKCdzdWJsaW5rJykgPiAwOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx2dXJsLDMwLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsJycpCiAgICAgICAgICAgICAgICAgICAgZWxzZTogCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsoc3RyKHZ1cmwpLG5hbWUsdGh1bWJuYWlsLGZhbmFydCwnJywnJywnJyxUcnVlLE5vbmUsJycsMSkKCQkJCQkJCiAgICAKICAgIHByb2dyZXNzLmNsb3NlKCkKICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MCkiKQoJCmRlZiBTZWFyY2hfbTN1KGRhdGEsU2VhcmNoa2V5KToKICAgIGNvbnRlbnQgPSBkYXRhLnJzdHJpcCgpCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUocicjRVhUSU5GOiguKz8pLCguKj8pW1xuXHJdKyhbXlxuXSspJykuZmluZGFsbChjb250ZW50KQogICAgdG90YWwgPSBsZW4obWF0Y2gpCiAgICBwcmludCAndG90YWwgbTN1IGxpbmtzJyx0b3RhbAogICAgZm9yIG90aGVyLGNoYW5uZWxfbmFtZSxzdHJlYW1fdXJsIGluIG1hdGNoOgogICAgICAgIGlmICd0dmctbG9nbycgaW4gb3RoZXI6CiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlX21lKG90aGVyLCd0dmctbG9nbz1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiB0aHVtYm5haWw6CiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKSA9PSAiIjoKICAgICAgICAgICAgICAgICAgICBsb2dvX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gbG9nb191cmwgKyB0aHVtYm5haWwKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAjZWxzZToKICAgICAgICAgICAgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICBpZiAndHlwZScgaW4gb3RoZXI6CiAgICAgICAgICAgIG1vZGVfdHlwZSA9IHJlX21lKG90aGVyLCd0eXBlPVtcJyJdKC4qPylbXCciXScpCiAgICAgICAgICAgIGlmIG1vZGVfdHlwZSA9PSAneXQtZGwnOgogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9IHN0cmVhbV91cmwgKyImbW9kZT0xOCIKICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ3JlZ2V4JzoKICAgICAgICAgICAgICAgIHVybCA9IHN0cmVhbV91cmwuc3BsaXQoJyZyZWdleHM9JykKICAgICAgICAgICAgICAgICNwcmludCB1cmxbMF0gZ2V0U291cCh1cmwsZGF0YT1Ob25lKQogICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgoZ2V0U291cCgnJyxkYXRhPXVybFsxXSkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBhZGRMaW5rKHN0cmVhbV91cmwsIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbCkKCmRlZiBGaW5kRmlyc3RQYXR0ZXJuKHRleHQscGF0dGVybik6CiAgICByZXN1bHQgPSAiIgogICAgdHJ5OiAgICAKICAgICAgICBtYXRjaGVzID0gcmUuZmluZGFsbChwYXR0ZXJuLHRleHQsIGZsYWdzPXJlLkRPVEFMTCkKICAgICAgICByZXN1bHQgPSBtYXRjaGVzWzBdCiAgICBleGNlcHQ6CiAgICAgICAgcmVzdWx0ID0gIiIKCiAgICByZXR1cm4gcmVzdWx0CgkKZGVmIHJlZ2V4X2dldF9hbGwodGV4dCwgc3RhcnRfd2l0aCwgZW5kX3dpdGgpOgogICAgciA9IHJlLmZpbmRhbGwoIig/aSkoIiArIHN0YXJ0X3dpdGggKyAiW1xTXHNdKz8iICsgZW5kX3dpdGggKyAiKSIsIHRleHQpCiAgICByZXR1cm4gcgkJCQkKCmRlZiByZWdleF9mcm9tX3RvKHRleHQsIGZyb21fc3RyaW5nLCB0b19zdHJpbmcsIGV4Y2x1ZGluZz1UcnVlKToKICAgIGlmIGV4Y2x1ZGluZzoKCSAgIHRyeTogciA9IHJlLnNlYXJjaCgiKD9pKSIgKyBmcm9tX3N0cmluZyArICIoW1xTXHNdKz8pIiArIHRvX3N0cmluZywgdGV4dCkuZ3JvdXAoMSkKCSAgIGV4Y2VwdDogciA9ICcnCiAgICBlbHNlOgogICAgICAgdHJ5OiByID0gcmUuc2VhcmNoKCIoP2kpKCIgKyBmcm9tX3N0cmluZyArICJbXFNcc10rPyIgKyB0b19zdHJpbmcgKyAiKSIsIHRleHQpLmdyb3VwKDEpCiAgICAgICBleGNlcHQ6IHIgPSAnJwogICAgcmV0dXJuIHIKCmRlZiBnZXRJdGVtcyhpdGVtcyxmYW5hcnQpOgogICAgICAgIHRvdGFsID0gbGVuKGl0ZW1zKQogICAgICAgIHByaW50ICdTVEFSVCBHRVQgSVRFTVMgKioqKionCiAgICAgICAgYWRkb25fbG9nKCdUb3RhbCBJdGVtczogJXMnICV0b3RhbCkKICAgICAgICBmb3IgaXRlbSBpbiBpdGVtczoKICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UKICAgICAgICAgICAgaXNKc29ucnBjID0gRmFsc2UKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbmFtZSA9IGl0ZW0oJ3RpdGxlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBuYW1lIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICd1bmtub3duPycKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdOYW1lIEVycm9yJykKICAgICAgICAgICAgICAgIG5hbWUgPSAnJwoKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGl0ZW0oJ2VwZycpOgogICAgICAgICAgICAgICAgICAgIGlmIGl0ZW0uZXBnX3VybDoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdHZXQgRVBHIFJlZ2V4JykKICAgICAgICAgICAgICAgICAgICAgICAgZXBnX3VybCA9IGl0ZW0uZXBnX3VybC5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXBnX3JlZ2V4ID0gaXRlbS5lcGdfcmVnZXguc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ19uYW1lID0gZ2V0X2VwZyhlcGdfdXJsLCBlcGdfcmVnZXgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVwZ19uYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSAnIC0gJyArIGVwZ19uYW1lCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpdGVtKCdlcGcnKVswXS5zdHJpbmcgPiAxOgogICAgICAgICAgICAgICAgICAgICAgICBuYW1lICs9IGdldGVwZyhpdGVtKCdlcGcnKVswXS5zdHJpbmcpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFUEcgRXJyb3InKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1cmwgPSBbXQogICAgICAgICAgICAgICAgaWYgbGVuKGl0ZW0oJ2xpbmsnKSkgPjA6CiMgICAgICAgICAgICAgICAgICAgIHByaW50ICdpdGVtIGxpbmsnLCBpdGVtKCdsaW5rJykKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdsaW5rJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChpLnN0cmluZykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3Nwb3J0c2RldmlsJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3Nwb3J0c2RldmlsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsLz9tb2RlPTEmYW1wO2l0ZW09Y2F0Y2hlciUzZHN0cmVhbXMlMjZ1cmw9JyAraS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZXIgPSBpdGVtKCdyZWZlcmVyJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZWZlcmVyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAncmVmZXJlciBmb3VuZCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcG9ydHNkZXZpbCA9IHNwb3J0c2RldmlsICsgJyUyNnJlZmVyZXI9JyArcmVmZXJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChzcG9ydHNkZXZpbCkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3AycCcpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdwMnAnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnc29wOi8vJyBpbiBpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvP3VybD0nK2kuc3RyaW5nICsnJmFtcDttb2RlPTImYW1wOycgKyAnbmFtZT0nK25hbWUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChzb3ApIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMnA9J3BsdWdpbjovL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy8/dXJsPScraS5zdHJpbmcgKycmYW1wO21vZGU9MSZhbXA7JyArICduYW1lPScrbmFtZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHAycCkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3ZhdWdobicpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd2YXVnaG4nKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXVnaG4gPSAncGx1Z2luOi8vcGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2Lz9tb2RlPVBsYXlMaXZlU3RyZWFtJmFtcDtjaGFubmVsPScraS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQodmF1Z2huKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnaWxpdmUnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnaWxpdmUnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgJ2h0dHAnIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlsaXZlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby50YmguaWxpdmUvP3VybD1odHRwOi8vd3d3LnN0cmVhbWxpdmUudG8vdmlldy8nK2kuc3RyaW5nKycmYW1wO2xpbms9OTkmYW1wO21vZGU9aUxpdmVQbGF5JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbGl2ZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8udGJoLmlsaXZlLz91cmw9JytpLnN0cmluZysnJmFtcDtsaW5rPTk5JmFtcDttb2RlPWlMaXZlUGxheScKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3l0LWRsJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3l0LWRsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRkbCA9IGkuc3RyaW5nICsgJyZtb2RlPTE4JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh5dGRsKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgndXR1YmUnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgndXR1YmUnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oaS5zdHJpbmcpID09IDExOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScrIGkuc3RyaW5nIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBpLnN0cmluZy5zdGFydHN3aXRoKCdQTCcpIGFuZCBub3QgJyZvcmRlcj0nIGluIGkuc3RyaW5nIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz8mb3JkZXI9ZGVmYXVsdCZwbGF5bGlzdF9pZD0nICsgaS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/cGxheWxpc3RfaWQ9JyArIGkuc3RyaW5nIAogICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQodXR1YmUpCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdpbWRiJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2ltZGInKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdnZW5lc2lzb3JwdWxzYXInKSA9PSAnMCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1kYiA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZ2VuZXNpcy8/YWN0aW9uPXBsYXkmaW1kYj0nK2kuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZGIgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9tb3ZpZS90dCcraS5zdHJpbmcrJy9wbGF5JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChpbWRiKSAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2Y0bScpKSA+MDoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZjRtJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnLmY0bScgaW4gaS5zdHJpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICcubTN1OCcgaW4gaS5zdHJpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykrJyZhbXA7c3RyZWFtdHlwZT1ITFMnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykrJyZhbXA7c3RyZWFtdHlwZT1TSU1QTEUnCiAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZjRtKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZnR2JykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2Z0dicpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ0diA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uRi5ULlYvP25hbWU9Jyt1cmxsaWIucXVvdGUobmFtZSkgKycmdXJsPScgK2kuc3RyaW5nICsnJm1vZGU9MTI1JmNoX2ZhbmFydD1uYScKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChmdHYpICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBsZW4odXJsKSA8IDE6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFcnJvciA8bGluaz4gZWxlbWVudCwgUGFzc2luZzonK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlzWE1MU291cmNlID0gaXRlbSgnZXh0ZXJuYWxsaW5rJylbMF0uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaXNYTUxTb3VyY2U6CiAgICAgICAgICAgICAgICBleHRfdXJsPVtpc1hNTFNvdXJjZV0KICAgICAgICAgICAgICAgIGlzWE1MU291cmNlPVRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlzSnNvbnJwYyA9IGl0ZW0oJ2pzb25ycGMnKVswXS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIGlmIGlzSnNvbnJwYzoKICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzSnNvbnJwY10KICAgICAgICAgICAgICAgIGlzSnNvbnJwYz1UcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpc0pzb25ycGM9RmFsc2UgICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gaXRlbSgndGh1bWJuYWlsJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBub3QgaXRlbSgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gaXRlbSgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGVzYyA9IGl0ZW0oJ2luZm8nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGRlc2MgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkZXNjID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGdlbnJlID0gaXRlbSgnZ2VucmUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZ2VucmUgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGF0ZSA9IGl0ZW0oJ2RhdGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkYXRlID0gJycKCiAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUKICAgICAgICAgICAgaWYgaXRlbSgncmVnZXgnKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByZWdfaXRlbSA9IGl0ZW0oJ3JlZ2V4JykKICAgICAgICAgICAgICAgICAgICByZWdleHMgPSBwYXJzZV9yZWdleChyZWdfaXRlbSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzICAgICAgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGxlbih1cmwpID4gMToKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBhbHQgPSAwCiAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QgPSBbXQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHVybDoKICAgICAgICAgICAgICAgICAgICAJaWYgYWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykgPT0gJ3RydWUnOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVnZXhzOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKycmcmVnZXhzPScrcmVnZXhzKQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAgYW55KHggaW4gaSBmb3IgeCBpbiByZXNvbHZlX3VybCkgYW5kICBpLnN0YXJ0c3dpdGgoJ2h0dHAnKToKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJm1vZGU9MTknKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKQogICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6ICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHVybDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdBRERMSU5LIDEnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayhpLCclcykgJXMnICUoYWx0LCBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUscGxheWxpc3QscmVnZXhzLHRvdGFsKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKCcnLCBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsVHJ1ZSxwbGF5bGlzdCxyZWdleHMsdG90YWwpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOgogICAgICAgICAgICAgICAgICAgIAlhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksZXh0X3VybFswXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgIGVsaWYgaXNKc29ucnBjOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksZXh0X3VybFswXSw1Myx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgIGVsaWYgdXJsWzBdLmZpbmQoJ3N1YmxpbmsnKSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSx1cmxbMF0sMzAsdGh1bWJuYWlsLGZhbmFydCwnJywnJywnJywnJykKICAgICAgICAgICAgICAgICAgICAgICAgI2FkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSx1cmxbMF0sMzAsdGh1bWJuYWlsLGZhbmFydCxkZXNjLGdlbnJlLGRhdGUsJ3N1YmxpbmsnKQkJCQkKICAgICAgICAgICAgICAgICAgICBlbHNlOiAKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayh1cmxbMF0sbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUsTm9uZSxyZWdleHMsdG90YWwpCgogICAgICAgICAgICAgICAgICAgICNwcmludCAnc3VjY2VzcycKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBpdGVtIC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiAgICAgICAgcHJpbnQgJ0ZJTklTSCBHRVQgSVRFTVMgKioqKionICAgICAgCgpkZWYgcGFyc2VfcmVnZXgocmVnX2l0ZW0pOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHt9CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmVnX2l0ZW06CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICNyZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlJ10gPSBpKCdleHByZXMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZSddID0gaSgnZXhwcmVzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZSddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXT0nJwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBSZWZlcmVyIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwYWdlJ10gPSBpKCdwYWdlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmVmZXInXSA9IGkoJ3JlZmVyZXInKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gUmVmZXJlciAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29ubmVjdGlvbiddID0gaSgnY29ubmVjdGlvbicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBjb25uZWN0aW9uIC0tIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbm90cGxheWFibGUnXSA9IGkoJ25vdHBsYXlhYmxlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vdHBsYXlhYmxlIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vcmVkaXJlY3QnXSA9IGkoJ25vcmVkaXJlY3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbm9yZWRpcmVjdCAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnb3JpZ2luJ10gPSBpKCdvcmlnaW4nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gb3JpZ2luIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpbmNsdWRlaGVhZGVycyddID0gaSgnaW5jbHVkZWhlYWRlcnMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gaW5jbHVkZWhlYWRlcnMgLS0iKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtcmVxJ10gPSBpKCd4LXJlcScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LXJlcSAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsneC1mb3J3YXJkJ10gPSBpKCd4LWZvcndhcmQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1mb3J3YXJkIC0tIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYWdlbnQnXSA9IGkoJ2FnZW50JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFVzZXIgQWdlbnQgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3Bvc3QnXSA9IGkoJ3Bvc3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgcG9zdCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmF3cG9zdCddID0gaSgncmF3cG9zdCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSByYXdwb3N0IikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydodG1sdW5lc2NhcGUnXSA9IGkoJ2h0bWx1bmVzY2FwZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBodG1sdW5lc2NhcGUiKQoKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmVhZGNvb2tpZW9ubHknXSA9IGkoJ3JlYWRjb29raWVvbmx5JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJlYWRDb29raWVPbmx5IikKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGkKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXSA9IGkoJ2Nvb2tpZWphcicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXT0nJwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBjb29raWVKYXIiKQkJCQkJCQkKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydzZXRjb29raWUnXSA9IGkoJ3NldGNvb2tpZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBzZXRjb29raWUiKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FwcGVuZGNvb2tpZSddID0gaSgnYXBwZW5kY29va2llJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIGFwcGVuZGNvb2tpZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpZ25vcmVjYWNoZSddID0gaSgnaWdub3JlY2FjaGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gbm8gaWdub3JlY2FjaGUiKQogICAgICAgICAgICAgICAgICAgICAgICAjdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaWdub3JlY2FjaGUnXSA9IGkoJ2lnbm9yZWNhY2hlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICNleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgYWRkb25fbG9nKCJSZWdleDogLS0gbm8gaWdub3JlY2FjaGUiKQkJCQoKICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB1cmxsaWIucXVvdGUocmVwcihyZWdleHMpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdleHMKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgcmVnZXhzCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gTm9uZQogICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygncmVnZXggRXJyb3I6ICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQojY29waWVzIGZyb20gbGFtZGEncyBpbXBsZW1lbnRhdGlvbgpkZWYgZ2V0X3VzdHJlYW0odXJsKToKICAgIHRyeToKICAgICAgICBmb3IgaSBpbiByYW5nZSgxLCA1MSk6CiAgICAgICAgICAgIHJlc3VsdCA9IGdldFVybCh1cmwpCiAgICAgICAgICAgIGlmICJFWFQtWC1TVFJFQU0tSU5GIiBpbiByZXN1bHQ6IHJldHVybiB1cmwKICAgICAgICAgICAgaWYgbm90ICJFWFRNM1UiIGluIHJlc3VsdDogcmV0dXJuCiAgICAgICAgICAgIHhibWMuc2xlZXAoMjAwMCkKICAgICAgICByZXR1cm4KICAgIGV4Y2VwdDoKICAgICAgICByZXR1cm4KICAgICAgICAKIApkZWYgZ2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwsY29va2llSmFyPU5vbmUsZm9yQ29va2llSmFyT25seT1GYWxzZSxyZWN1cnNpdmVDYWxsPUZhbHNlLGNhY2hlZFBhZ2VzPXt9LCByYXdQb3N0PUZhbHNlLCBjb29raWVfamFyX2ZpbGU9Tm9uZSk6IzAsMSwyID0gVVJMLCByZWdleE9ubHksIENvb2tpZUphck9ubHkKICAgICAgICBpZiBub3QgcmVjdXJzaXZlQ2FsbDoKICAgICAgICAgICAgcmVnZXhzID0gZXZhbCh1cmxsaWIudW5xdW90ZShyZWdleHMpKQogICAgICAgICNjYWNoZWRQYWdlcyA9IHt9CiAgICAgICAgI3ByaW50ICd1cmwnLHVybAogICAgICAgIGRvUmVnZXhzID0gcmUuY29tcGlsZSgnXCRkb3JlZ2V4XFsoW15cXV0qKVxdJykuZmluZGFsbCh1cmwpCiAgICAgICAgI3ByaW50ICdkb1JlZ2V4cycsZG9SZWdleHMscmVnZXhzCiAgICAgICAgc2V0cmVzb2x2ZWQ9VHJ1ZQogICAgICAgICAgICAgIAogCgoKICAgICAgICBmb3IgayBpbiBkb1JlZ2V4czoKICAgICAgICAgICAgaWYgayBpbiByZWdleHM6CiAgICAgICAgICAgICAgICAjcHJpbnQgJ3Byb2Nlc3NpbmcgJyAsawogICAgICAgICAgICAgICAgbSA9IHJlZ2V4c1trXQogICAgICAgICAgICAgICAgI3ByaW50IG0KICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPUZhbHNlCgoKICAgICAgICAgICAgICAgIGlmICAnY29va2llamFyJyBpbiBtOiAjIHNvIGVpdGhlciBjcmVhdGUgb3IgcmV1c2UgZXhpc3RpbmcgamFyCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVqYXIgZXhpc3RzJyxtWydjb29raWVqYXInXQogICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPW1bJ2Nvb2tpZWphciddCiAgICAgICAgICAgICAgICAgICAgaWYgICckZG9yZWdleCcgaW4gY29va2llSmFyUGFyYW06CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphcj1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2Nvb2tpZWphciddLGNvb2tpZUphcixUcnVlLCBUcnVlLGNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1UcnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09VHJ1ZQogICAgICAgICAgICAgICAgI3ByaW50ICdtW2Nvb2tpZWphcl0nLG1bJ2Nvb2tpZWphciddLGNvb2tpZUphcgogICAgICAgICAgICAgICAgaWYgY29va2llSmFyUGFyYW06CiAgICAgICAgICAgICAgICAgICAgaWYgY29va2llSmFyPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2NyZWF0ZSBjb29raWUgamFyJwogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9Tm9uZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnb3BlblsnIGluIG1bJ2Nvb2tpZWphciddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2phcl9maWxlPW1bJ2Nvb2tpZWphciddLnNwbGl0KCdvcGVuWycpWzFdLnNwbGl0KCddJylbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXI9Z2V0Q29va2llSmFyKGNvb2tpZV9qYXJfZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29va2llX2phcl9maWxlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICAjaW1wb3J0IGNvb2tpZWxpYgogICAgICAgICAgICAgICAgICAgICAgICAjY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llSmFyIG5ldycsY29va2llSmFyCiAgICAgICAgICAgICAgICAgICAgZWxpZiAnc2F2ZVsnIGluIG1bJ2Nvb2tpZWphciddOgogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ3NhdmVbJylbMV0uc3BsaXQoJ10nKVswXQogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLGNvb2tpZV9qYXJfZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2NvbXBsZXRlX3BhdGgnLGNvbXBsZXRlX3BhdGgKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICAKIAogICAgICAgICAgICAgICAgaWYgIG1bJ3BhZ2UnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydwYWdlJ106CiAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsncGFnZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCgogICAgICAgICAgICAgICAgaWYgJ3NldGNvb2tpZScgaW4gbSBhbmQgbVsnc2V0Y29va2llJ10gYW5kICckZG9yZWdleCcgaW4gbVsnc2V0Y29va2llJ106CiAgICAgICAgICAgICAgICAgICAgbVsnc2V0Y29va2llJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydzZXRjb29raWUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgaWYgJ2FwcGVuZGNvb2tpZScgaW4gbSBhbmQgbVsnYXBwZW5kY29va2llJ10gYW5kICckZG9yZWdleCcgaW4gbVsnYXBwZW5kY29va2llJ106CiAgICAgICAgICAgICAgICAgICAgbVsnYXBwZW5kY29va2llJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydhcHBlbmRjb29raWUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQoKICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICAncG9zdCcgaW4gbSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydwb3N0J106CiAgICAgICAgICAgICAgICAgICAgbVsncG9zdCddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsncG9zdCddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Bvc3QgaXMgbm93JyxtWydwb3N0J10KCiAgICAgICAgICAgICAgICBpZiAgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncmF3cG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3Jhd3Bvc3QnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzLHJhd1Bvc3Q9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3Jhd3Bvc3QgaXMgbm93JyxtWydyYXdwb3N0J10KICAKICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtIGFuZCAnJGVwb2N0aW1lJCcgaW4gbVsncmF3cG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1tWydyYXdwb3N0J10ucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkKICAKICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtIGFuZCAnJGVwb2N0aW1lMiQnIGluIG1bJ3Jhd3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109bVsncmF3cG9zdCddLnJlcGxhY2UoJyRlcG9jdGltZTIkJyxnZXRFcG9jVGltZTIoKSkKCiAgCiAgICAgICAgICAgICAgICBsaW5rPScnCiAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kIG1bJ3BhZ2UnXSBpbiBjYWNoZWRQYWdlcyBhbmQgbm90ICdpZ25vcmVjYWNoZScgaW4gbSBhbmQgZm9yQ29va2llSmFyT25seT09RmFsc2UgOgogICAgICAgICAgICAgICAgICAgIGxpbmsgPSBjYWNoZWRQYWdlc1ttWydwYWdlJ11dCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ109PScnIGFuZCAgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZSQnIGluIG1bJ3BhZ2UnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1bJ3BhZ2UnXT1tWydwYWdlJ10ucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiBtWydwYWdlJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109bVsncGFnZSddLnJlcGxhY2UoJyRlcG9jdGltZTIkJyxnZXRFcG9jVGltZTIoKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnSW5nb3JpbmcgQ2FjaGUnLG1bJ3BhZ2UnXQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlX3NwbGl0PW1bJ3BhZ2UnXS5zcGxpdCgnfCcpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VVcmw9cGFnZV9zcGxpdFswXQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1Ob25lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihwYWdlX3NwbGl0KT4xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9cGFnZV9zcGxpdFsxXQogICAgICAgICAgICAgICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QocGFnZVVybCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdyZWZlcicgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdSZWZlcmVyJywgbVsncmVmZXInXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2FnZW50JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItYWdlbnQnLCBtWydhZ2VudCddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1yZXEnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignWC1SZXF1ZXN0ZWQtV2l0aCcsIG1bJ3gtcmVxJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICd4LWZvcndhcmQnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignWC1Gb3J3YXJkZWQtRm9yJywgbVsneC1mb3J3YXJkJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzZXRjb29raWUnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2FwcGVuZGNvb2tpZScgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhcHBlbmRpbmcgY29va2llIHRvIGNvb2tpZWphcicsbVsnYXBwZW5kY29va2llJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZXN0b0FwZW5kPW1bJ2FwcGVuZGNvb2tpZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzdG9BcGVuZD1jb29raWVzdG9BcGVuZC5zcGxpdCgnOycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaCBpbiBjb29raWVzdG9BcGVuZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdyxuPSBuLnNwbGl0KCc6JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjayA9IGNvb2tpZWxpYi5Db29raWUodmVyc2lvbj0wLCBuYW1lPW4sIHZhbHVlPXYsIHBvcnQ9Tm9uZSwgcG9ydF9zcGVjaWZpZWQ9RmFsc2UsIGRvbWFpbj13LCBkb21haW5fc3BlY2lmaWVkPUZhbHNlLCBkb21haW5faW5pdGlhbF9kb3Q9RmFsc2UsIHBhdGg9Jy8nLCBwYXRoX3NwZWNpZmllZD1UcnVlLCBzZWN1cmU9RmFsc2UsIGV4cGlyZXM9Tm9uZSwgZGlzY2FyZD1UcnVlLCBjb21tZW50PU5vbmUsIGNvbW1lbnRfdXJsPU5vbmUsIHJlc3Q9eydIdHRwT25seSc6IE5vbmV9LCByZmMyMTA5PUZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphci5zZXRfY29va2llKGNrKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29yaWdpbicgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdPcmlnaW4nLCBtWydvcmlnaW4nXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGVhZGVyX2luX3BhZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1oZWFkZXJfaW5fcGFnZS5zcGxpdCgnJicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaCBpbiBoZWFkZXJfaW5fcGFnZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIobix2KQoKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjb29raWVKYXI9PU5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZUphclZhbCcsY29va2llSmFyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfaGFuZGxlciA9IHVybGxpYjIuSFRUUENvb2tpZVByb2Nlc3Nvcihjb29raWVKYXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdub3JlZGlyZWN0JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lcjIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihOb1JlZGlyZWN0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2Nvbm5lY3Rpb24nIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5jb25uZWN0aW9uLy8vLy8vLicsbVsnY29ubmVjdGlvbiddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGtlZXBhbGl2ZSBpbXBvcnQgSFRUUEhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXBhbGl2ZV9oYW5kbGVyID0gSFRUUEhhbmRsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoa2VlcGFsaXZlX2hhbmRsZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2FmdGVyIGNvb2tpZSBqYXInCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9Tm9uZQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Bvc3QnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YT1tWydwb3N0J10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbVJlY2FwdGNoYScgaW4gcG9zdERhdGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3REYXRhKz0ncmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZDonK2NhcHRjaGFfY2hhbGxlbmdlKycscmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkOicrY2F0cGNoYV93b3JkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpdHBvc3Q9cG9zdERhdGEuc3BsaXQoJywnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9e30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBwIGluIHNwbGl0cG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuPXAuc3BsaXQoJzonKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2PXAuc3BsaXQoJzonKVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0W25dPXYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QgPSB1cmxsaWIudXJsZW5jb2RlKHBvc3QpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9bVsncmF3cG9zdCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1SZWNhcHRjaGEnIGluIHBvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCs9JyZyZWNhcHRjaGFfY2hhbGxlbmdlX2ZpZWxkPScrY2FwdGNoYV9jaGFsbGVuZ2UrJyZyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ9JytjYXRwY2hhX3dvcmQKCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBwb3N0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxLHBvc3QpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpCgogICAgICAgICAgICAgICAgICAgICAgICBsaW5rID0gcmVzcG9uc2UucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9amF2YXNjcmlwdFVuRXNjYXBlKGxpbmspCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rIFRoaXMganVzdCBwcmludCB3aG9sZSB3ZWJwYWdlIGluIExPRwogICAgICAgICAgICAgICAgICAgICAgICBpZiAnaW5jbHVkZWhlYWRlcnMnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rKz1zdHIocmVzcG9uc2UuaGVhZGVycy5nZXQoJ1NldC1Db29raWUnKSkKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkUGFnZXNbbVsncGFnZSddXSA9IGxpbmsKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdzdG9yZSBsaW5rIGZvcicsbVsncGFnZSddLGZvckNvb2tpZUphck9ubHkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29va2llSmFyIyBkbyBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgZWxpZiBtWydwYWdlJ10gYW5kICBub3QgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbVsncGFnZSddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWRvRXZhbChtWydwYWdlJ10uc3BsaXQoJyRweUZ1bmN0aW9uOicpWzFdLCcnLGNvb2tpZUphciApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JDb29raWVKYXJPbmx5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb29raWVKYXIjIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9dmFsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPW1bJ3BhZ2UnXQogICAgICAgICAgICAgICAgaWYgJyRweUZ1bmN0aW9uOnBsYXltZWRpYSgnIGluIG1bJ2V4cHJlJ10gb3IgJ0FjdGl2YXRlV2luZG93JyAgaW4gbVsnZXhwcmUnXSAgIG9yICBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCk6CiAgICAgICAgICAgICAgICAgICAgc2V0cmVzb2x2ZWQ9RmFsc2UKICAgICAgICAgICAgICAgIGlmICAnJGRvcmVnZXgnIGluIG1bJ2V4cHJlJ106CiAgICAgICAgICAgICAgICAgICAgbVsnZXhwcmUnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2V4cHJlJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IG1bJ2V4cHJlJ109PScnOgogICAgICAgICAgICAgICAgICAgIHByaW50ICdkb2luZyBpdCAnLG1bJ2V4cHJlJ10KICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1DYXB0Y2hhJyBpbiBtWydleHByZSddOgogICAgICAgICAgICAgICAgICAgICAgICB2YWw9YXNrQ2FwdGNoYShtLGxpbmssY29va2llSmFyKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3VybCBhbmQgdmFsJyx1cmwsdmFsCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsnZXhwcmUnXS5zdGFydHN3aXRoKCckcHlGdW5jdGlvbjonKToKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdleHBlZWVlZWVlZWVlZWVlZWVlZWVlJyxtWydleHByZSddCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsnZXhwcmUnXS5zcGxpdCgnJHB5RnVuY3Rpb246JylbMV0sbGluayxjb29raWVKYXIgKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnQWN0aXZhdGVXaW5kb3cnIGluIG1bJ2V4cHJlJ106IHJldHVybiAKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3N0aWxsIGhyZScKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3VybCBrIHZhbCcsdXJsLGssdmFsCgogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbGluaz09Jyc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWcgPSByZS5jb21waWxlKG1bJ2V4cHJlJ10pLnNlYXJjaChsaW5rKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPScnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlZy5ncm91cCgxKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPW1bJ2V4cHJlJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmF3UG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdyYXdwb3N0JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXVybGxpYi5xdW90ZV9wbHVzKHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2h0bWx1bmVzY2FwZScgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICN2YWw9dXJsbGliLnVucXVvdGVfcGx1cyh2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgSFRNTFBhcnNlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPUhUTUxQYXJzZXIuSFRNTFBhcnNlcigpLnVuZXNjYXBlKHZhbCkgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCB2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICNyZXR1cm4gdmFsCiAgICAgICAgICAgICAgICBlbHNlOiAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCcnKQogICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiB1cmw6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkKICAgICAgICBpZiAnJGVwb2N0aW1lMiQnIGluIHVybDoKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpCgogICAgICAgIGlmICckR1VJRCQnIGluIHVybDoKICAgICAgICAgICAgaW1wb3J0IHV1aWQKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckR1VJRCQnLHN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkpCiAgICAgICAgaWYgJyRnZXRfY29va2llcyQnIGluIHVybDoKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZ2V0X2Nvb2tpZXMkJyxnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcikpICAgCgogICAgICAgIGlmIHJlY3Vyc2l2ZUNhbGw6IHJldHVybiB1cmwKICAgICAgICBwcmludCAnZmluYWwgdXJsJyx1cmwKICAgICAgICBpZiB1cmw9PSIiOiAKICAgICAgICAJcmV0dXJuCiAgICAgICAgZWxzZToKICAgICAgICAJcmV0dXJuIHVybCxzZXRyZXNvbHZlZAoKICAgICAgICAgICAgCiAgICAgICAgCmRlZiBnZXRtZDUodCk6CiAgICBpbXBvcnQgaGFzaGxpYgogICAgaD1oYXNobGliLm1kNSgpCiAgICBoLnVwZGF0ZSh0KQogICAgcmV0dXJuIGguaGV4ZGlnZXN0KCkKCmRlZiBkZWNyeXB0X3ZhdWdobmxpdmUoZW5jcnlwdGVkKToKICAgIHJldFZhbD0iIgogICAgZm9yIHZhbCBpbiBlbmNyeXB0ZWQuc3BsaXQoJzonKToKICAgICAgICByZXRWYWwrPWNocihpbnQodmFsLnJlcGxhY2UoIjBtMCIsIiIpKS84NC81KQogICAgcmV0dXJuIHJldFZhbAoKZGVmIHBsYXltZWRpYShtZWRpYV91cmwpOgogICAgdHJ5OgogICAgICAgIGltcG9ydCAgQ3VzdG9tUGxheWVyCiAgICAgICAgcGxheWVyID0gQ3VzdG9tUGxheWVyLk15WEJNQ1BsYXllcigpCiAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKCBsYWJlbCA9IHN0cihuYW1lKSwgaWNvbkltYWdlID0gIkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZSA9IHhibWMuZ2V0SW5mb0ltYWdlKCAiTGlzdEl0ZW0uVGh1bWIiICksIHBhdGg9bWVkaWFfdXJsICkKICAgICAgICBwbGF5ZXIucGxheSggbWVkaWFfdXJsLGxpc3RpdGVtKQogICAgICAgIHhibWMuc2xlZXAoMTAwMCkKICAgICAgICB3aGlsZSBwbGF5ZXIuaXNfYWN0aXZlOgogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMCkKICAgIGV4Y2VwdDoKICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgIHJldHVybiAnJwogICAgCiAgICAgICAgCmRlZiBnZXRfc2F3X3J0bXAocGFnZV92YWx1ZSwgcmVmZXJlcj1Ob25lKToKICAgIGlmIHJlZmVyZXI6CiAgICAgICAgcmVmZXJlcj1bKCdSZWZlcmVyJyxyZWZlcmVyKV0KICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgIHBhZ2VfdXJsPXBhZ2VfdmFsdWUKICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpCgogICAgc3RyX3BhdHRlcm49IihldmFsXChmdW5jdGlvblwocCxhLGMsayxlLCg/OnJ8ZCkuKikiCgogICAgcmVnX3Jlcz1yZS5jb21waWxlKHN0cl9wYXR0ZXJuKS5maW5kYWxsKHBhZ2VfdmFsdWUpCiAgICByPSIiCiAgICBpZiByZWdfcmVzIGFuZCBsZW4ocmVnX3Jlcyk+MDoKICAgICAgICBmb3IgdiBpbiByZWdfcmVzOgogICAgICAgICAgICByMT1nZXRfdW5wYWNrZWQodikKICAgICAgICAgICAgcjI9cmVfbWUocjEsJ1wnKC4qPylcJycpCiAgICAgICAgICAgIGlmICd1bmVzY2FwZScgaW4gcjE6CiAgICAgICAgICAgICAgICByMT11cmxsaWIudW5xdW90ZShyMikKICAgICAgICAgICAgcis9cjErJ1xuJwogICAgICAgIHByaW50ICdmaW5hbCB2YWx1ZSBpcyAnLHIKICAgICAgICAKICAgICAgICBwYWdlX3VybD1yZV9tZShyLCdzcmM9IiguKj8pIicpCiAgICAgICAgCiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdXJsLGhlYWRlcnM9cmVmZXJlcikKCiAgICAjcHJpbnQgcGFnZV92YWx1ZQoKICAgIHJ0bXA9cmVfbWUocGFnZV92YWx1ZSwnc3RyZWFtZXJcJy4qP1wnKC4qPylcJ1wpJykKICAgIHBsYXlwYXRoPXJlX21lKHBhZ2VfdmFsdWUsJ2ZpbGVcJyxcc1wnKC4qPylcJycpCgogICAgCiAgICByZXR1cm4gcnRtcCsnIHBsYXlwYXRoPScrcGxheXBhdGggKycgcGFnZVVybD0nK3BhZ2VfdXJsCiAgICAKZGVmIGdldF9sZXRvbl9ydG1wKHBhZ2VfdmFsdWUsIHJlZmVyZXI9Tm9uZSk6CiAgICBpZiByZWZlcmVyOgogICAgICAgIHJlZmVyZXI9WygnUmVmZXJlcicscmVmZXJlcildCiAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpCiAgICBzdHJfcGF0dGVybj0idmFyIGEgPSAoLio/KTtccyp2YXIgYiA9ICguKj8pO1xzKnZhciBjID0gKC4qPyk7XHMqdmFyIGQgPSAoLio/KTtccyp2YXIgZiA9ICguKj8pO1xzKnZhciB2X3BhcnQgPSAnKC4qPyknOyIKICAgIHJlZ19yZXM9cmUuY29tcGlsZShzdHJfcGF0dGVybikuZmluZGFsbChwYWdlX3ZhbHVlKVswXSAKCiAgICBhLGIsYyxkLGYsdj0ocmVnX3JlcykKICAgIGY9aW50KGYpCiAgICBhPWludChhKS9mCiAgICBiPWludChiKS9mCiAgICBjPWludChjKS9mCiAgICBkPWludChkKS9mCgogICAgcmV0PSAncnRtcDovLycgKyBzdHIoYSkgKyAnLicgKyBzdHIoYikgKyAnLicgKyBzdHIoYykgKyAnLicgKyBzdHIoZCkgKyB2OwogICAgcmV0dXJuIHJldAoKZGVmIGNyZWF0ZU0zdUZvckRhc2godXJsLHVzZXJhZ2VudD1Ob25lKToKICAgIHN0cj0nI0VYVE0zVScKICAgIHN0cis9J1xuI0VYVC1YLVNUUkVBTS1JTkY6UFJPR1JBTS1JRD0xLEJBTkRXSURUSD0zNjE4MTYnCiAgICBzdHIrPSdcbicrdXJsKycmYnl0ZXM9MC0yMDAwMDAnIysnfFVzZXItQWdlbnQ9Jyt1c2VyYWdlbnQKICAgIHNvdXJjZV9maWxlID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZXN0ZmlsZS5tM3UnKQogICAgc3RyKz0nXG4nCiAgICBTYXZlVG9GaWxlKHNvdXJjZV9maWxlLHN0cikKICAgICNyZXR1cm4gJ0M6L1VzZXJzL3NoYW5pL0Rvd25sb2Fkcy90ZXN0Lm0zdTgnCiAgICByZXR1cm4gc291cmNlX2ZpbGUKCmRlZiBTYXZlVG9GaWxlKGZpbGVfbmFtZSxwYWdlX2RhdGEsYXBwZW5kPUZhbHNlKToKICAgIGlmIGFwcGVuZDoKICAgICAgICBmID0gb3BlbihmaWxlX25hbWUsICdhJykKICAgICAgICBmLndyaXRlKHBhZ2VfZGF0YSkKICAgICAgICBmLmNsb3NlKCkgICAgICAgIAogICAgZWxzZToKICAgICAgICBmPW9wZW4oZmlsZV9uYW1lLCd3YicpCiAgICAgICAgZi53cml0ZShwYWdlX2RhdGEpCiAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgcmV0dXJuICcnCiAgICAKZGVmIExvYWRGaWxlKGZpbGVfbmFtZSk6CglmPW9wZW4oZmlsZV9uYW1lLCdyYicpCglkPWYucmVhZCgpCglmLmNsb3NlKCkKCXJldHVybiBkCiAgICAKZGVmIGdldF9wYWNrZWRfaXBob25ldHZfdXJsKHBhZ2VfZGF0YSk6CglpbXBvcnQgcmUsYmFzZTY0LHVybGxpYjsgCglzPXBhZ2VfZGF0YQoJd2hpbGUgJ2dlaCgnIGluIHM6CgkJaWYgcy5zdGFydHN3aXRoKCdsb2woJyk6IHM9c1s1Oi0xXSAgICAKIwkJcHJpbnQgJ3MgaXMgJyxzCgkJcz1yZS5jb21waWxlKCciKC4qPykiJykuZmluZGFsbChzKVswXTsgCgkJcz0gIGJhc2U2NC5iNjRkZWNvZGUocyk7IAoJCXM9dXJsbGliLnVucXVvdGUocyk7IAoJcHJpbnQgcwoJcmV0dXJuIHMKCmRlZiBnZXRfZmVycmFyaV91cmwocGFnZV9kYXRhKToKICAgIHByaW50ICdnZXRfZGFnX3VybDInLHBhZ2VfZGF0YQogICAgcGFnZV9kYXRhMj1nZXRVcmwocGFnZV9kYXRhKTsKICAgIHBhdHQ9JyhodHRwLiopJwogICAgaW1wb3J0IHV1aWQKICAgIHBsYXliYWNrPXN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkKICAgIGxpbmtzPXJlLmNvbXBpbGUocGF0dCkuZmluZGFsbChwYWdlX2RhdGEyKQogICAgaGVhZGVycz1bKCdYLVBsYXliYWNrLVNlc3Npb24tSWQnLHBsYXliYWNrKV0KICAgIGZvciBsIGluIGxpbmtzOgogICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBhZ2VfZGF0YXRlbXA9Z2V0VXJsKGwsaGVhZGVycz1oZWFkZXJzKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQ6IHBhc3MKICAgIAogICAgcmV0dXJuIHBhZ2VfZGF0YSsnfCZYLVBsYXliYWNrLVNlc3Npb24tSWQ9JytwbGF5YmFjawoKICAgIApkZWYgZ2V0X2RhZ191cmwocGFnZV9kYXRhKToKICAgIHByaW50ICdnZXRfZGFnX3VybCcscGFnZV9kYXRhCiAgICBpZiBwYWdlX2RhdGEuc3RhcnRzd2l0aCgnaHR0cDovL2RhZy50b3RhbC1zdHJlYW0ubmV0Jyk6CiAgICAgICAgaGVhZGVycz1bKCdVc2VyLUFnZW50JywnVmVyaXNtby1CbGFja1VJXygyLjQuNy41LjguMC4zNCknKV0KICAgICAgICBwYWdlX2RhdGE9Z2V0VXJsKHBhZ2VfZGF0YSxoZWFkZXJzPWhlYWRlcnMpOwoKICAgIGlmICcxMjcuMC4wLjEnIGluIHBhZ2VfZGF0YToKICAgICAgICByZXR1cm4gcmV2aXN0X2RhZyhwYWdlX2RhdGEpCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICc/d21zQXV0aFNpZ249JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSArICc9PS9tcDQ6JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFteJl0rKSYnKQogICAgZWxzZToKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdocmVmPSIoW14iXSspIlteIl0rJCcpCiAgICAgICAgaWYgbGVuKGZpbmFsX3VybCk9PTA6CiAgICAgICAgICAgIGZpbmFsX3VybD1wYWdlX2RhdGEKICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybC5yZXBsYWNlKCcgJywgJyUyMCcpCiAgICByZXR1cm4gZmluYWxfdXJsCgpkZWYgcmVfbWUoZGF0YSwgcmVfcGF0dGVuKToKICAgIG1hdGNoID0gJycKICAgIG0gPSByZS5zZWFyY2gocmVfcGF0dGVuLCBkYXRhKQogICAgaWYgbSAhPSBOb25lOgogICAgICAgIG1hdGNoID0gbS5ncm91cCgxKQogICAgZWxzZToKICAgICAgICBtYXRjaCA9ICcnCiAgICByZXR1cm4gbWF0Y2gKCmRlZiByZXZpc3RfZGFnKHBhZ2VfZGF0YSk6CiAgICBmaW5hbF91cmwgPSAnJwogICAgaWYgJzEyNy4wLjAuMScgaW4gcGFnZV9kYXRhOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJyBsaXZlPXRydWUgdGltZW91dD0xNSBwbGF5cGF0aD0nICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW2EtekEtWjAtOS1fXFwuQF0rKScpCiAgICAgICAgCiAgICBpZiByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybCArICc/dG9rZW49JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykKICAgIGVsaWYgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJz93bXNBdXRoU2lnbj0nICsgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICsgJz09L21wNDonICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW14mXSspJicpCiAgICBlbHNlOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJ0hSRUY9IihbXiJdKykiJykKCiAgICBpZiAnZGFnMS5hc3gnIGluIGZpbmFsX3VybDoKICAgICAgICByZXR1cm4gZ2V0X2RhZ191cmwoZmluYWxfdXJsKQoKICAgIGlmICdkZXZpbmxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOgogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybC5yZXBsYWNlKCdkZXZpbmxpdmUnLCAnZmxpdmUnKQogICAgaWYgJ3Blcm1saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoKICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgncGVybWxpdmUnLCAnZmxpdmUnKQogICAgcmV0dXJuIGZpbmFsX3VybAoKCmRlZiBnZXRfdW53aXNlKCBzdHJfZXZhbCk6CiAgICBwYWdlX3ZhbHVlPSIiCiAgICB0cnk6ICAgICAgICAKICAgICAgICBzcz0idyxpLHMsZT0oIitzdHJfZXZhbCsnKScgCiAgICAgICAgZXhlYyAoc3MpCiAgICAgICAgcGFnZV92YWx1ZT11bndpc2VfZnVuYyh3LGkscyxlKQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKICAgICNwcmludCAndW5wYWNrZWQnLHBhZ2VfdmFsdWUKICAgIHJldHVybiBwYWdlX3ZhbHVlCiAgICAKZGVmIHVud2lzZV9mdW5jKCB3LCBpLCBzLCBlKToKICAgIGxJbGwgPSAwOwogICAgbGwxSSA9IDA7CiAgICBJbDFsID0gMDsKICAgIGxsMWwgPSBbXTsKICAgIGwxbEkgPSBbXTsKICAgIHdoaWxlIFRydWU6CiAgICAgICAgaWYgKGxJbGwgPCA1KToKICAgICAgICAgICAgbDFsSS5hcHBlbmQod1tsSWxsXSkKICAgICAgICBlbGlmIChsSWxsIDwgbGVuKHcpKToKICAgICAgICAgICAgbGwxbC5hcHBlbmQod1tsSWxsXSk7CiAgICAgICAgbElsbCs9MTsKICAgICAgICBpZiAobGwxSSA8IDUpOgogICAgICAgICAgICBsMWxJLmFwcGVuZChpW2xsMUldKQogICAgICAgIGVsaWYgKGxsMUkgPCBsZW4oaSkpOgogICAgICAgICAgICBsbDFsLmFwcGVuZChpW2xsMUldKQogICAgICAgIGxsMUkrPTE7CiAgICAgICAgaWYgKElsMWwgPCA1KToKICAgICAgICAgICAgbDFsSS5hcHBlbmQoc1tJbDFsXSkKICAgICAgICBlbGlmIChJbDFsIDwgbGVuKHMpKToKICAgICAgICAgICAgbGwxbC5hcHBlbmQoc1tJbDFsXSk7CiAgICAgICAgSWwxbCs9MTsKICAgICAgICBpZiAobGVuKHcpICsgbGVuKGkpICsgbGVuKHMpICsgbGVuKGUpID09IGxlbihsbDFsKSArIGxlbihsMWxJKSArIGxlbihlKSk6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIAogICAgbEkxbCA9ICcnLmpvaW4obGwxbCkjLmpvaW4oJycpOwogICAgSTFsSSA9ICcnLmpvaW4obDFsSSkjLmpvaW4oJycpOwogICAgbGwxSSA9IDA7CiAgICBsMWxsID0gW107CiAgICBmb3IgbElsbCBpbiByYW5nZSgwLGxlbihsbDFsKSwyKToKICAgICAgICAjcHJpbnQgJ2FycmF5IGknLGxJbGwsbGVuKGxsMWwpCiAgICAgICAgbGwxMSA9IC0xOwogICAgICAgIGlmICggb3JkKEkxbElbbGwxSV0pICUgMik6CiAgICAgICAgICAgIGxsMTEgPSAxOwogICAgICAgICNwcmludCAndmFsIGlzICcsIGxJMWxbbElsbDogbElsbCsyXQogICAgICAgIGwxbGwuYXBwZW5kKGNociggICAgaW50KGxJMWxbbElsbDogbElsbCsyXSwgMzYpIC0gbGwxMSkpOwogICAgICAgIGxsMUkrPTE7CiAgICAgICAgaWYgKGxsMUkgPj0gbGVuKGwxbEkpKToKICAgICAgICAgICAgbGwxSSA9IDA7CiAgICByZXQ9Jycuam9pbihsMWxsKQogICAgaWYgJ2V2YWwoZnVuY3Rpb24odyxpLHMsZSknIGluIHJldDoKICAgICAgICBwcmludCAnU1RJTEwgR09pbmcnCiAgICAgICAgcmV0PXJlLmNvbXBpbGUoJ2V2YWxcKGZ1bmN0aW9uXCh3LGkscyxlXCkuKn1cKCguKj8pXCknKS5maW5kYWxsKHJldClbMF0gCiAgICAgICAgcmV0dXJuIGdldF91bndpc2UocmV0KQogICAgZWxzZToKICAgICAgICBwcmludCAnRklOSVNIRUQnCiAgICAgICAgcmV0dXJuIHJldAogICAgCmRlZiBnZXRfdW5wYWNrZWQoIHBhZ2VfdmFsdWUsIHJlZ2V4X2Zvcl90ZXh0PScnLCBpdGVyYXRpb25zPTEsIHRvdGFsX2l0ZXJhdGlvbj0xKToKICAgIHRyeTogICAgICAgIAogICAgICAgIHJlZ19kYXRhPU5vbmUKICAgICAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUpCiAgICAgICAgcHJpbnQgJ3BhZ2VfdmFsdWUnLHBhZ2VfdmFsdWUKICAgICAgICBpZiByZWdleF9mb3JfdGV4dCBhbmQgbGVuKHJlZ2V4X2Zvcl90ZXh0KT4wOgogICAgICAgICAgICBwYWdlX3ZhbHVlPXJlLmNvbXBpbGUocmVnZXhfZm9yX3RleHQpLmZpbmRhbGwocGFnZV92YWx1ZSlbMF0gI2dldCB0aGUganMgdmFyaWFibGUKICAgICAgICAKICAgICAgICBwYWdlX3ZhbHVlPXVucGFjayhwYWdlX3ZhbHVlLGl0ZXJhdGlvbnMsdG90YWxfaXRlcmF0aW9uKQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKICAgIHByaW50ICd1bnBhY2tlZCcscGFnZV92YWx1ZQogICAgaWYgJ3NhdjFsaXZlLnR2JyBpbiBwYWdlX3ZhbHVlOgogICAgICAgIHBhZ2VfdmFsdWU9cGFnZV92YWx1ZS5yZXBsYWNlKCdzYXYxbGl2ZS50dicsJ3Nhd2xpdmUudHYnKSAjcXVpY2sgZml4IHNvbWUgYnVnIHNvbWV3aGVyZQogICAgICAgIHByaW50ICdzYXYxIHVucGFja2VkJyxwYWdlX3ZhbHVlCiAgICByZXR1cm4gcGFnZV92YWx1ZQoKZGVmIHVucGFjayhzSmF2YXNjcmlwdCxpdGVyYXRpb249MSwgdG90YWxpdGVyYXRpb25zPTIgICk6CiAgICBwcmludCAnaXRlcmF0aW9uJyxpdGVyYXRpb24KICAgIGlmIHNKYXZhc2NyaXB0LnN0YXJ0c3dpdGgoJ3ZhciBfMHhjYjhhPScpOgogICAgICAgIGFTcGxpdD1zSmF2YXNjcmlwdC5zcGxpdCgndmFyIF8weGNiOGE9JykKICAgICAgICBzcz0ibXlhcnJheT0iK2FTcGxpdFsxXS5zcGxpdCgiZXZhbCgiKVswXQogICAgICAgIGV4ZWMoc3MpCiAgICAgICAgYTE9NjIKICAgICAgICBjMT1pbnQoYVNwbGl0WzFdLnNwbGl0KCIsNjIsIilbMV0uc3BsaXQoJywnKVswXSkKICAgICAgICBwMT1teWFycmF5WzBdCiAgICAgICAgazE9bXlhcnJheVszXQogICAgICAgIHdpdGggb3BlbigndGVtcCBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoKICAgICAgICAgICAgZmlsZXdyaXRlci53cml0ZShzdHIoazEpKQogICAgICAgICNhYT0xLzAKICAgIGVsc2U6CgogICAgICAgIGFTcGxpdCA9IHNKYXZhc2NyaXB0LnNwbGl0KCJybiBwfSgnIikKICAgICAgICBwcmludCBhU3BsaXQKICAgICAgICAKICAgICAgICBwMSxhMSxjMSxrMT0oJycsJzAnLCcwJywnJykKICAgICAKICAgICAgICBzcz0icDEsYTEsYzEsazE9KCciK2FTcGxpdFsxXS5zcGxpdCgiLnNwbGkiKVswXSsnKScgCiAgICAgICAgZXhlYyhzcykKICAgIGsxPWsxLnNwbGl0KCd8JykKICAgIGFTcGxpdCA9IGFTcGxpdFsxXS5zcGxpdCgiKSknIikKIyAgICBwcmludCAnIHAgYXJyYXkgaXMgJyxsZW4oYVNwbGl0KQojICAgcHJpbnQgbGVuKGFTcGxpdCApCgogICAgI3A9c3RyKGFTcGxpdFswXSsnKSknKSMucmVwbGFjZSgiXFwiLCIiKSMucmVwbGFjZSgnXFxcXCcsJ1xcJykKCiAgICAjcHJpbnQgYVNwbGl0WzFdCiAgICAjYVNwbGl0ID0gYVNwbGl0WzFdLnNwbGl0KCIsIikKICAgICNwcmludCBhU3BsaXRbMF0gCiAgICAjYSA9IGludChhU3BsaXRbMV0pCiAgICAjYyA9IGludChhU3BsaXRbMl0pCiAgICAjayA9IGFTcGxpdFszXS5zcGxpdCgiLiIpWzBdLnJlcGxhY2UoIiciLCAnJykuc3BsaXQoJ3wnKQogICAgI2E9aW50KGEpCiAgICAjYz1pbnQoYykKICAgIAogICAgI3A9cC5yZXBsYWNlKCdcXCcsICcnKQojICAgIHByaW50ICdwIHZhbCBpcyAnLHBbMDoxMDBdLCcuLi4uLi4uLi4uLi4nLHBbLTEwMDpdLGxlbihwKQojICAgIHByaW50ICdwMSB2YWwgaXMgJyxwMVswOjEwMF0sJy4uLi4uLi4uLi4uLicscDFbLTEwMDpdLGxlbihwMSkKICAgIAogICAgI3ByaW50IGEsYTEKICAgICNwcmludCBjLGExCiAgICAjcHJpbnQgJ2sgdmFsIGlzICcsa1stMTA6XSxsZW4oaykKIyAgICBwcmludCAnazEgdmFsIGlzICcsazFbLTEwOl0sbGVuKGsxKQogICAgZSA9ICcnCiAgICBkID0gJycjMzI4MjMKCiAgICAjc1VucGFja2VkID0gc3RyKF9fdW5wYWNrKHAsIGEsIGMsIGssIGUsIGQpKQogICAgc1VucGFja2VkMSA9IHN0cihfX3VucGFjayhwMSwgYTEsIGMxLCBrMSwgZSwgZCxpdGVyYXRpb24pKQogICAgCiAgICAjcHJpbnQgc1VucGFja2VkWzoyMDBdKycuLi4uJytzVW5wYWNrZWRbLTEwMDpdLCBsZW4oc1VucGFja2VkKQojICAgIHByaW50IHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkKICAgIAogICAgI2V4ZWMoJ3NVbnBhY2tlZDE9Iicrc1VucGFja2VkMSsnIicpCiAgICBpZiBpdGVyYXRpb24+PXRvdGFsaXRlcmF0aW9uczoKIyAgICAgICAgcHJpbnQgJ2ZpbmFsIHJlcycsc1VucGFja2VkMVs6MjAwXSsnLi4uLicrc1VucGFja2VkMVstMTAwOl0sIGxlbihzVW5wYWNrZWQxKQogICAgICAgIHJldHVybiBzVW5wYWNrZWQxIy5yZXBsYWNlKCdcXFxcJywgJ1xcJykKICAgIGVsc2U6CiMgICAgICAgIHByaW50ICdmaW5hbCByZXMgZm9yIHRoaXMgaXRlcmF0aW9uIGlzJyxpdGVyYXRpb24KICAgICAgICByZXR1cm4gdW5wYWNrKHNVbnBhY2tlZDEsaXRlcmF0aW9uKzEpIy5yZXBsYWNlKCdcXCcsICcnKSxpdGVyYXRpb24pIy5yZXBsYWNlKCdcXCcsICcnKTsjdW5wYWNrKHNVbnBhY2tlZC5yZXBsYWNlKCdcXCcsICcnKSkKCmRlZiBfX3VucGFjayhwLCBhLCBjLCBrLCBlLCBkLCBpdGVyYXRpb24sdj0xKToKCiAgICAjd2l0aCBvcGVuKCdiZWZvcmUgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6CiAgICAjICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKHApKQogICAgd2hpbGUgKGMgPj0gMSk6CiAgICAgICAgYyA9IGMgLTEKICAgICAgICBpZiAoa1tjXSk6CiAgICAgICAgICAgIGFhPXN0cihfX2l0b2FOZXcoYywgYSkpCiAgICAgICAgICAgIGlmIHY9PTE6CiAgICAgICAgICAgICAgICBwPXJlLnN1YignXFxiJyArIGFhICsnXFxiJywga1tjXSwgcCkjIFRISVMgSVMgQmxvb2R5IHNsb3chCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pCgogICAgICAgICAgICAjcD1maW5kQW5kUmVwbGFjZVdvcmQocCxhYSxrW2NdKQoKICAgICAgICAgICAgCiAgICAjd2l0aCBvcGVuKCdhZnRlciBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoKICAgICMgICAgZmlsZXdyaXRlci53cml0ZShzdHIocCkpCiAgICByZXR1cm4gcAoKIwojZnVuY3Rpb24gZXF1YWxhdmVudCB0byByZS5zdWIoJ1xcYicgKyBhYSArJ1xcYicsIGtbY10sIHApCmRlZiBmaW5kQW5kUmVwbGFjZVdvcmQoc291cmNlX3N0ciwgd29yZF90b19maW5kLHJlcGxhY2Vfd2l0aCk6CiAgICBzcGxpdHM9Tm9uZQogICAgc3BsaXRzPXNvdXJjZV9zdHIuc3BsaXQod29yZF90b19maW5kKQogICAgaWYgbGVuKHNwbGl0cyk+MToKICAgICAgICBuZXdfc3RyaW5nPVtdCiAgICAgICAgY3VycmVudF9pbmRleD0wCiAgICAgICAgZm9yIGN1cnJlbnRfc3BsaXQgaW4gc3BsaXRzOgogICAgICAgICAgICAjcHJpbnQgJ2hlcmUnLGkKICAgICAgICAgICAgbmV3X3N0cmluZy5hcHBlbmQoY3VycmVudF9zcGxpdCkKICAgICAgICAgICAgdmFsPXdvcmRfdG9fZmluZCNieSBkZWZhdWx0IGFzc3VtZSBpdCB3YXMgd3JvbmcgdG8gc3BsaXQKCiAgICAgICAgICAgICNpZiBpdHMgZmlyc3Qgb25lIGFuZCBpdGVtIGlzIGJsYW5rIHRoZW4gY2hlY2sgbmV4dCBpdGVtIGlzIHZhbGlkIG9yIG5vdAogICAgICAgICAgICBpZiBjdXJyZW50X2luZGV4PT1sZW4oc3BsaXRzKS0xOgogICAgICAgICAgICAgICAgdmFsPScnICMgbGFzdCBvbmUgbm90aGluZyB0byBhcHBlbmQgbm9ybWFsbHkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIGxlbihjdXJyZW50X3NwbGl0KT09MDogI2lmIGJsYW5rIGNoZWNrIG5leHQgb25lIHdpdGggY3VycmVudCBzcGxpdCB2YWx1ZQogICAgICAgICAgICAgICAgICAgIGlmICggbGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT09MCBhbmQgd29yZF90b19maW5kWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgb3IgKGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk+MCAgYW5kIHNwbGl0c1tjdXJyZW50X2luZGV4KzFdWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJyk6IyBmaXJzdCBqdXN0IGp1c3QgY2hlY2sgbmV4dAogICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVwbGFjZV93aXRoCiAgICAgICAgICAgICAgICAjbm90IGJsYW5rLCB0aGVuIGNoZWNrIGN1cnJlbnQgZW5kdmFsdWUgYW5kIG5leHQgZmlyc3QgdmFsdWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgKHNwbGl0c1tjdXJyZW50X2luZGV4XVstMV0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBhbmQgKCggbGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT09MCBhbmQgd29yZF90b19maW5kWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgb3IgKGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk+MCAgYW5kIHNwbGl0c1tjdXJyZW50X2luZGV4KzFdWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykpOiMgZmlyc3QganVzdCBqdXN0IGNoZWNrIG5leHQKICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlcGxhY2Vfd2l0aAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgbmV3X3N0cmluZy5hcHBlbmQodmFsKQogICAgICAgICAgICBjdXJyZW50X2luZGV4Kz0xCiAgICAgICAgI2FhYWE9MS8wCiAgICAgICAgc291cmNlX3N0cj0nJy5qb2luKG5ld19zdHJpbmcpCiAgICByZXR1cm4gc291cmNlX3N0ciAgICAgICAgCgpkZWYgX19pdG9hKG51bSwgcmFkaXgpOgojICAgIHByaW50ICdudW0gcmVkJyxudW0sIHJhZGl4CiAgICByZXN1bHQgPSAiIgogICAgaWYgbnVtPT0wOiByZXR1cm4gJzAnCiAgICB3aGlsZSBudW0gPiAwOgogICAgICAgIHJlc3VsdCA9ICIwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiW251bSAlIHJhZGl4XSArIHJlc3VsdAogICAgICAgIG51bSAvPSByYWRpeAogICAgcmV0dXJuIHJlc3VsdAoJCmRlZiBfX2l0b2FOZXcoY2MsIGEpOgogICAgYWE9IiIgaWYgY2MgPCBhIGVsc2UgX19pdG9hTmV3KGludChjYyAvIGEpLGEpIAogICAgY2MgPSAoY2MgJSBhKQogICAgYmI9Y2hyKGNjICsgMjkpIGlmIGNjPiAzNSBlbHNlIHN0cihfX2l0b2EoY2MsMzYpKQogICAgcmV0dXJuIGFhK2JiCgoKZGVmIGdldENvb2tpZXNTdHJpbmcoY29va2llSmFyKToKICAgIHRyeToKICAgICAgICBjb29raWVTdHJpbmc9IiIKICAgICAgICBmb3IgaW5kZXgsIGNvb2tpZSBpbiBlbnVtZXJhdGUoY29va2llSmFyKToKICAgICAgICAgICAgY29va2llU3RyaW5nKz1jb29raWUubmFtZSArICI9IiArIGNvb2tpZS52YWx1ZSArIjsiCiAgICBleGNlcHQ6IHBhc3MKICAgICNwcmludCAnY29va2llU3RyaW5nJyxjb29raWVTdHJpbmcKICAgIHJldHVybiBjb29raWVTdHJpbmcKCgpkZWYgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsQ09PS0lFRklMRSk6Cgl0cnk6CgkJY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxDT09LSUVGSUxFKQoJCWNvb2tpZUphci5zYXZlKGNvbXBsZXRlX3BhdGgsaWdub3JlX2Rpc2NhcmQ9VHJ1ZSkKCWV4Y2VwdDogcGFzcwoKZGVmIGdldENvb2tpZUphcihDT09LSUVGSUxFKToKCgljb29raWVKYXI9Tm9uZQoJaWYgQ09PS0lFRklMRToKCQl0cnk6CgkJCWNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsQ09PS0lFRklMRSkKCQkJY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpCgkJCWNvb2tpZUphci5sb2FkKGNvbXBsZXRlX3BhdGgsaWdub3JlX2Rpc2NhcmQ9VHJ1ZSkKCQlleGNlcHQ6IAoJCQljb29raWVKYXI9Tm9uZQoJCglpZiBub3QgY29va2llSmFyOgoJCWNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQoJCglyZXR1cm4gY29va2llSmFyCiAgICAKZGVmIGRvRXZhbChmdW5fY2FsbCxwYWdlX2RhdGEsQ29va2llX0phcik6CiAgICByZXRfdmFsPScnCiAgICBpZiBmdW5jdGlvbnNfZGlyIG5vdCBpbiBzeXMucGF0aDoKICAgICAgICBzeXMucGF0aC5hcHBlbmQoZnVuY3Rpb25zX2RpcikKICAgIAogICAgcHJpbnQgZnVuX2NhbGwKICAgIHRyeToKICAgICAgICBweV9maWxlPSdpbXBvcnQgJytmdW5fY2FsbC5zcGxpdCgnLicpWzBdCiAgICAgICAgcHJpbnQgcHlfZmlsZSxzeXMucGF0aAogICAgICAgIGV4ZWMoIHB5X2ZpbGUpCiAgICAgICAgcHJpbnQgJ2RvbmUnCiAgICBleGNlcHQ6CiAgICAgICAgcHJpbnQgJ2Vycm9yIGluIGltcG9ydCcKICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKICAgIHByaW50ICdyZXRfdmFsPScrZnVuX2NhbGwKICAgIGV4ZWMgKCdyZXRfdmFsPScrZnVuX2NhbGwpCiAgICBwcmludCByZXRfdmFsCiAgICAjZXhlYygncmV0X3ZhbD0xKzEnKQogICAgcmV0dXJuIHN0cihyZXRfdmFsKQogICAgCmRlZiBwcm9jZXNzUmVjYXB0Y2hhKHVybCk6CglodG1sX3RleHQ9Z2V0VXJsKHVybCkKCXJlY2FwQ2hhbGxlbmdlPSIiCglzb2x1dGlvbj0iIgoJY2FwX3JlZz0iPHNjcmlwdC4qP3NyYz1cIiguKj9yZWNhcC4qPylcIiIKCW1hdGNoID1yZS5maW5kYWxsKGNhcF9yZWcsIGh0bWxfdGV4dCkKCWNhcHRjaGE9RmFsc2UKCWNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsPU5vbmUKCXNvbHV0aW9uPU5vbmUKCQoJaWYgbWF0Y2ggYW5kIGxlbihtYXRjaCk+MDogI25ldyBzaGlueSBjYXB0Y2hhIQoJCWNhcHRjaGFfdXJsPW1hdGNoWzBdCgkJY2FwdGNoYT1UcnVlCgkJCgkJY2FwX2NoYWxsX3JlZz0nY2hhbGxlbmdlLio/XCcoLio/KVwnJwoJCWNhcF9pbWFnZV9yZWc9J1wnKC4qPylcJycKCQljYXB0Y2hhX3NjcmlwdD1nZXRVcmwoY2FwdGNoYV91cmwpCgkJcmVjYXBDaGFsbGVuZ2U9cmUuZmluZGFsbChjYXBfY2hhbGxfcmVnLCBjYXB0Y2hhX3NjcmlwdClbMF0KCQljYXB0Y2hhX3JlbG9hZD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvcmVsb2FkP2M9JzsKCQljYXB0Y2hhX2s9Y2FwdGNoYV91cmwuc3BsaXQoJ2s9JylbMV0KCQljYXB0Y2hhX3JlbG9hZCs9cmVjYXBDaGFsbGVuZ2UrJyZrPScrY2FwdGNoYV9rKycmY2FwdGNoYV9rPTEmdHlwZT1pbWFnZSZsYW5nPWVuLUdCJwoJCWNhcHRjaGFfcmVsb2FkX2pzPWdldFVybChjYXB0Y2hhX3JlbG9hZCkKCQljYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1yZS5maW5kYWxsKGNhcF9pbWFnZV9yZWcsIGNhcHRjaGFfcmVsb2FkX2pzKVswXQoJCWNhcHRjaGFfaW1hZ2VfdXJsPSdodHRwOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS9pbWFnZT9jPScrY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGwKCQlpZiBub3QgY2FwdGNoYV9pbWFnZV91cmwuc3RhcnRzd2l0aCgiaHR0cCIpOgoJCQljYXB0Y2hhX2ltYWdlX3VybD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvJytjYXB0Y2hhX2ltYWdlX3VybAoJCWltcG9ydCByYW5kb20KCQluPXJhbmRvbS5yYW5kcmFuZ2UoMTAwLDEwMDAsNSkKCQlsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsc3RyKG4pICsiY2FwdGNoYS5pbWciICkKCQlsb2NhbEZpbGUgPSBvcGVuKGxvY2FsX2NhcHRjaGEsICJ3YiIpCgkJbG9jYWxGaWxlLndyaXRlKGdldFVybChjYXB0Y2hhX2ltYWdlX3VybCkpCgkJbG9jYWxGaWxlLmNsb3NlKCkKCQlzb2x2ZXIgPSBJbnB1dFdpbmRvdyhjYXB0Y2hhPWxvY2FsX2NhcHRjaGEpCgkJc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkKCQlvcy5yZW1vdmUobG9jYWxfY2FwdGNoYSkKCXJldHVybiBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbCAsc29sdXRpb24KCmRlZiBnZXRVcmwodXJsLCBjb29raWVKYXI9Tm9uZSxwb3N0PU5vbmUsIHRpbWVvdXQ9MjAsIGhlYWRlcnM9Tm9uZSk6CgoKCWNvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikKCW9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkKCSNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKCXJlcSA9IHVybGxpYjIuUmVxdWVzdCh1cmwpCglyZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8zMy4wLjE3NTAuMTU0IFNhZmFyaS81MzcuMzYnKQoJaWYgaGVhZGVyczoKCQlmb3IgaCxodiBpbiBoZWFkZXJzOgoJCQlyZXEuYWRkX2hlYWRlcihoLGh2KQoKCXJlc3BvbnNlID0gb3BlbmVyLm9wZW4ocmVxLHBvc3QsdGltZW91dD10aW1lb3V0KQoJbGluaz1yZXNwb25zZS5yZWFkKCkKCXJlc3BvbnNlLmNsb3NlKCkKCXJldHVybiBsaW5rOwoKZGVmIGdldF9kZWNvZGUoc3RyLHJlZz1Ob25lKToKCWlmIHJlZzoKCQlzdHI9cmUuZmluZGFsbChyZWcsIHN0cilbMF0KCXMxID0gdXJsbGliLnVucXVvdGUoc3RyWzA6IGxlbihzdHIpLTFdKTsKCXQgPSAnJzsKCWZvciBpIGluIHJhbmdlKCBsZW4oczEpKToKCQl0ICs9IGNocihvcmQoczFbaV0pIC0gczFbbGVuKHMxKS0xXSk7Cgl0PXVybGxpYi51bnF1b3RlKHQpCglwcmludCB0CglyZXR1cm4gdAoKZGVmIGphdmFzY3JpcHRVbkVzY2FwZShzdHIpOgoJanM9cmUuZmluZGFsbCgndW5lc2NhcGVcKFwnKC4qPylcJycsc3RyKQoJcHJpbnQgJ2pzJyxqcwoJaWYgKG5vdCBqcz09Tm9uZSkgYW5kIGxlbihqcyk+MDoKCQlmb3IgaiBpbiBqczoKCQkJI3ByaW50IHVybGxpYi51bnF1b3RlKGopCgkJCXN0cj1zdHIucmVwbGFjZShqICx1cmxsaWIudW5xdW90ZShqKSkKCXJldHVybiBzdHIKCmlpZD0wCmRlZiBhc2tDYXB0Y2hhKG0saHRtbF9wYWdlLCBjb29raWVKYXIpOgogICAgZ2xvYmFsIGlpZAogICAgaWlkKz0xCiAgICBleHByZT0gbVsnZXhwcmUnXQogICAgcGFnZV91cmwgPSBtWydwYWdlJ10KICAgIGNhcHRjaGFfcmVnZXg9cmUuY29tcGlsZSgnXCRMaXZlU3RyZWFtQ2FwdGNoYVxbKFteXF1dKilcXScpLmZpbmRhbGwoZXhwcmUpWzBdCgogICAgY2FwdGNoYV91cmw9cmUuY29tcGlsZShjYXB0Y2hhX3JlZ2V4KS5maW5kYWxsKGh0bWxfcGFnZSlbMF0KICAgIHByaW50IGV4cHJlLGNhcHRjaGFfcmVnZXgsY2FwdGNoYV91cmwKICAgIGlmIG5vdCBjYXB0Y2hhX3VybC5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgcGFnZV89J2h0dHA6Ly8nKyIiLmpvaW4ocGFnZV91cmwuc3BsaXQoJy8nKVsyOjNdKQogICAgICAgIGlmIGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoIi8iKToKICAgICAgICAgICAgY2FwdGNoYV91cmw9cGFnZV8rY2FwdGNoYV91cmwKICAgICAgICBlbHNlOgogICAgICAgICAgICBjYXB0Y2hhX3VybD1wYWdlXysnLycrY2FwdGNoYV91cmwKICAgIAogICAgbG9jYWxfY2FwdGNoYSA9IG9zLnBhdGguam9pbihwcm9maWxlLCBzdHIoaWlkKSsiY2FwdGNoYS5qcGciICkKICAgIGxvY2FsRmlsZSA9IG9wZW4obG9jYWxfY2FwdGNoYSwgIndiIikKICAgIHByaW50ICcgYyBjYXB1cmwnLGNhcHRjaGFfdXJsCiAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QoY2FwdGNoYV91cmwpCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJykKICAgIGlmICdyZWZlcicgaW4gbToKICAgICAgICByZXEuYWRkX2hlYWRlcignUmVmZXJlcicsIG1bJ3JlZmVyJ10pCiAgICBpZiAnYWdlbnQnIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItYWdlbnQnLCBtWydhZ2VudCddKQogICAgaWYgJ3NldGNvb2tpZScgaW4gbToKICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10KICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pCiAgICAgICAgCiAgICAjY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgI29wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkKICAgICNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgIHVybGxpYjIudXJsb3BlbihyZXEpCiAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpCgogICAgbG9jYWxGaWxlLndyaXRlKHJlc3BvbnNlLnJlYWQoKSkKICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgIGxvY2FsRmlsZS5jbG9zZSgpCiAgICBzb2x2ZXIgPSBJbnB1dFdpbmRvdyhjYXB0Y2hhPWxvY2FsX2NhcHRjaGEpCiAgICBzb2x1dGlvbiA9IHNvbHZlci5nZXQoKQogICAgcmV0dXJuIHNvbHV0aW9uCiAgICAKY2xhc3MgSW5wdXRXaW5kb3coeGJtY2d1aS5XaW5kb3dEaWFsb2cpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgc2VsZi5jcHRsb2MgPSBrd2FyZ3MuZ2V0KCdjYXB0Y2hhJykKICAgICAgICBzZWxmLmltZyA9IHhibWNndWkuQ29udHJvbEltYWdlKDMzNSwzMCw2MjQsNjAsc2VsZi5jcHRsb2MpCiAgICAgICAgc2VsZi5hZGRDb250cm9sKHNlbGYuaW1nKQogICAgICAgIHNlbGYua2JkID0geGJtYy5LZXlib2FyZCgpCgogICAgZGVmIGdldChzZWxmKToKICAgICAgICBzZWxmLnNob3coKQogICAgICAgIHRpbWUuc2xlZXAoMikgICAgICAgIAogICAgICAgIHNlbGYua2JkLmRvTW9kYWwoKQogICAgICAgIGlmIChzZWxmLmtiZC5pc0NvbmZpcm1lZCgpKToKICAgICAgICAgICAgdGV4dCA9IHNlbGYua2JkLmdldFRleHQoKQogICAgICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICAgICAgcmV0dXJuIHRleHQKICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICByZXR1cm4gRmFsc2UKICAgIApkZWYgZ2V0RXBvY1RpbWUoKToKICAgIGltcG9ydCB0aW1lCiAgICByZXR1cm4gc3RyKGludCh0aW1lLnRpbWUoKSoxMDAwKSkKCmRlZiBnZXRFcG9jVGltZTIoKToKICAgIGltcG9ydCB0aW1lCiAgICByZXR1cm4gc3RyKGludCh0aW1lLnRpbWUoKSkpCgpkZWYgZ2V0X3BhcmFtcygpOgogICAgICAgIHBhcmFtPVtdCiAgICAgICAgcGFyYW1zdHJpbmc9c3lzLmFyZ3ZbMl0KICAgICAgICBpZiBsZW4ocGFyYW1zdHJpbmcpPj0yOgogICAgICAgICAgICBwYXJhbXM9c3lzLmFyZ3ZbMl0KICAgICAgICAgICAgY2xlYW5lZHBhcmFtcz1wYXJhbXMucmVwbGFjZSgnPycsJycpCiAgICAgICAgICAgIGlmIChwYXJhbXNbbGVuKHBhcmFtcyktMV09PScvJyk6CiAgICAgICAgICAgICAgICBwYXJhbXM9cGFyYW1zWzA6bGVuKHBhcmFtcyktMl0KICAgICAgICAgICAgcGFpcnNvZnBhcmFtcz1jbGVhbmVkcGFyYW1zLnNwbGl0KCcmJykKICAgICAgICAgICAgcGFyYW09e30KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHBhaXJzb2ZwYXJhbXMpKToKICAgICAgICAgICAgICAgIHNwbGl0cGFyYW1zPXt9CiAgICAgICAgICAgICAgICBzcGxpdHBhcmFtcz1wYWlyc29mcGFyYW1zW2ldLnNwbGl0KCc9JykKICAgICAgICAgICAgICAgIGlmIChsZW4oc3BsaXRwYXJhbXMpKT09MjoKICAgICAgICAgICAgICAgICAgICBwYXJhbVtzcGxpdHBhcmFtc1swXV09c3BsaXRwYXJhbXNbMV0KICAgICAgICByZXR1cm4gcGFyYW0KCgpkZWYgZ2V0RmF2b3JpdGVzKCk6CiAgICAgICAgaXRlbXMgPSBqc29uLmxvYWRzKG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkpCiAgICAgICAgdG90YWwgPSBsZW4oaXRlbXMpCiAgICAgICAgZm9yIGkgaW4gaXRlbXM6CiAgICAgICAgICAgIG5hbWUgPSBpWzBdCiAgICAgICAgICAgIHVybCA9IGlbMV0KICAgICAgICAgICAgaWNvbmltYWdlID0gaVsyXQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmYW5BcnQgPSBpWzNdCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gaWNvbmltYWdlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICB0cnk6IHBsYXlsaXN0ID0gaVs1XQogICAgICAgICAgICBleGNlcHQ6IHBsYXlsaXN0ID0gTm9uZQogICAgICAgICAgICB0cnk6IHJlZ2V4cyA9IGlbNl0KICAgICAgICAgICAgZXhjZXB0OiByZWdleHMgPSBOb25lCgogICAgICAgICAgICBpZiBpWzRdID09IDA6CiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCxuYW1lLGljb25pbWFnZSxmYW5BcnQsJycsJycsJycsJ2ZhdicscGxheWxpc3QscmVnZXhzLHRvdGFsKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsLGlbNF0saWNvbmltYWdlLGZhbmFydCwnJywnJywnJywnJywnZmF2JykKCgpkZWYgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0PU5vbmUscmVnZXhzPU5vbmUpOgogICAgICAgIGZhdkxpc3QgPSBbXQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMgKyAndHh0Jyk6CiAgICAgICAgICAgIG9zLm1ha2VkaXJzKGZhdm9yaXRlcyArICd0eHQnKQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhoaXN0b3J5KToKICAgICAgICAgICAgb3MubWFrZWRpcnMoaGlzdG9yeSkKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgc2VlbXMgdGhhdCBhZnRlcgogICAgICAgICAgICBuYW1lID0gbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKT09RmFsc2U6CiAgICAgICAgICAgIGFkZG9uX2xvZygnTWFraW5nIEZhdm9yaXRlcyBGaWxlJykKICAgICAgICAgICAgZmF2TGlzdC5hcHBlbmQoKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSxwbGF5bGlzdCxyZWdleHMpKQogICAgICAgICAgICBhID0gb3BlbihmYXZvcml0ZXMsICJ3IikKICAgICAgICAgICAgYS53cml0ZShqc29uLmR1bXBzKGZhdkxpc3QpKQogICAgICAgICAgICBhLmNsb3NlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBhZGRvbl9sb2coJ0FwcGVuZGluZyBGYXZvcml0ZXMnKQogICAgICAgICAgICBhID0gb3BlbihmYXZvcml0ZXMpLnJlYWQoKQogICAgICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhhKQogICAgICAgICAgICBkYXRhLmFwcGVuZCgobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlKSkKICAgICAgICAgICAgYiA9IG9wZW4oZmF2b3JpdGVzLCAidyIpCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkKICAgICAgICAgICAgYi5jbG9zZSgpCgoKZGVmIHJtRmF2b3JpdGUobmFtZSk6CiAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMob3BlbihmYXZvcml0ZXMpLnJlYWQoKSkKICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UobGVuKGRhdGEpKToKICAgICAgICAgICAgaWYgZGF0YVtpbmRleF1bMF09PW5hbWU6CiAgICAgICAgICAgICAgICBkZWwgZGF0YVtpbmRleF0KICAgICAgICAgICAgICAgIGIgPSBvcGVuKGZhdm9yaXRlcywgInciKQogICAgICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKGRhdGEpKQogICAgICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlJlZnJlc2giKQoKZGVmIHVybHNvbHZlcih1cmwpOgogICAgaWYgYWRkb24uZ2V0U2V0dGluZygnVXBkYXRlY29tbW9ucmVzb2x2ZXJzJykgPT0gJ3RydWUnOgogICAgICAgIGwgPSBvcy5wYXRoLmpvaW4oaG9tZSwnZ2VuZXNpc3Jlc29sdmVycy5weScpCiAgICAgICAgaWYgeGJtY3Zmcy5leGlzdHMobCk6CiAgICAgICAgICAgIG9zLnJlbW92ZShsKQoKICAgICAgICBnZW5lc2lzX3VybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbGFtYmRhODEvbGFtYmRhLWFkZG9ucy9tYXN0ZXIvcGx1Z2luLnZpZGVvLmdlbmVzaXMvY29tbW9ucmVzb2x2ZXJzLnB5JwogICAgICAgIHRoPSB1cmxsaWIudXJscmV0cmlldmUoZ2VuZXNpc191cmwsbCkKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCdVcGRhdGVjb21tb25yZXNvbHZlcnMnLCAnZmFsc2UnKQogICAgdHJ5OgogICAgICAgIGltcG9ydCBnZW5lc2lzcmVzb2x2ZXJzCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKERlamFWdSxQbGVhc2UgZW5hYmxlIFVwZGF0ZSBDb21tb25yZXNvbHZlcnMgdG8gUGxheSBpbiBTZXR0aW5ncy4gLSAsMTAwMDApIikKCiAgICByZXNvbHZlZD1nZW5lc2lzcmVzb2x2ZXJzLmdldCh1cmwpLnJlc3VsdAogICAgaWYgdXJsID09IHJlc29sdmVkIG9yIHJlc29sdmVkIGlzIE5vbmU6CiAgICAgICAgI2ltcG9ydAogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKERlamFWdSxJcyBGaW5kaW5nIFlvdXIgTGluayAtICw1MDAwKSIpCiAgICAgICAgaW1wb3J0IHJlc29sdmV1cmwKICAgICAgICBob3N0ID0gcmVzb2x2ZXVybC5Ib3N0ZWRNZWRpYUZpbGUodXJsKQogICAgICAgIGlmIGhvc3Q6CiAgICAgICAgICAgIHJlc29sdmVyID0gcmVzb2x2ZXVybC5yZXNvbHZlKHVybCkKICAgICAgICAgICAgcmVzb2x2ZWQgPSByZXNvbHZlcgogICAgaWYgcmVzb2x2ZWQgOgogICAgICAgIGlmIGlzaW5zdGFuY2UocmVzb2x2ZWQsbGlzdCk6CiAgICAgICAgICAgIGZvciBrIGluIHJlc29sdmVkOgogICAgICAgICAgICAgICAgcXVhbGl0eSA9IGFkZG9uLmdldFNldHRpbmcoJ3F1YWxpdHknKQogICAgICAgICAgICAgICAgaWYga1sncXVhbGl0eSddID09ICdIRCcgIDoKICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsaWYga1sncXVhbGl0eSddID09ICdTRCcgOgogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10KICAgICAgICAgICAgICAgIGVsaWYga1sncXVhbGl0eSddID09ICcxMDgwcCcgYW5kIGFkZG9uLmdldFNldHRpbmcoJzEwODBwcXVhbGl0eScpID09ICd0cnVlJyA6CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmVzb2x2ZXIgPSByZXNvbHZlZAogICAgcmV0dXJuIHJlc29sdmVyCmRlZiBwbGF5X3BsYXlsaXN0KG5hbWUsIG11X3BsYXlsaXN0KToKICAgICAgICBpbXBvcnQgdXJscGFyc2UKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhc2tfcGxheWxpc3RfaXRlbXMnKSA9PSAndHJ1ZSc6CiAgICAgICAgICAgIG5hbWVzID0gW10KICAgICAgICAgICAgZm9yIGkgaW4gbXVfcGxheWxpc3Q6CiAgICAgICAgICAgICAgICBkX25hbWU9dXJscGFyc2UudXJscGFyc2UoaSkubmV0bG9jCiAgICAgICAgICAgICAgICBpZiBkX25hbWUgPT0gJyc6CiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKG5hbWUpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChkX25hbWUpCiAgICAgICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkKICAgICAgICAgICAgaW5kZXggPSBkaWFsb2cuc2VsZWN0KCdDaG9vc2UgYSB2aWRlbyBzb3VyY2UnLCBuYW1lcykKICAgICAgICAgICAgaWYgaW5kZXggPj0gMDoKICAgICAgICAgICAgICAgIGlmICImbW9kZT0xOSIgaW4gbXVfcGxheWxpc3RbaW5kZXhdOgogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmxzb2x2ZXIobXVfcGxheWxpc3RbaW5kZXhdLnJlcGxhY2UoJyZtb2RlPTE5JywnJykpKQogICAgICAgICAgICAgICAgZWxpZiAiJGRvcmVnZXgiIGluIG11X3BsYXlsaXN0W2luZGV4XSA6CgogICAgICAgICAgICAgICAgICAgIHNlcGF0ZSA9IG11X3BsYXlsaXN0W2luZGV4XS5zcGxpdCgnJnJlZ2V4cz0nKQoKICAgICAgICAgICAgICAgICAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChzZXBhdGVbMV0sIHNlcGF0ZVswXSkKICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB1cmwgPSBtdV9wbGF5bGlzdFtpbmRleF0KICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHBsYXlsaXN0ID0geGJtYy5QbGF5TGlzdCgxKSAjIDEgbWVhbnMgdmlkZW8KICAgICAgICAgICAgcGxheWxpc3QuY2xlYXIoKQogICAgICAgICAgICBpdGVtID0gMAogICAgICAgICAgICBmb3IgaSBpbiBtdV9wbGF5bGlzdDoKICAgICAgICAgICAgICAgIGl0ZW0gKz0gMQogICAgICAgICAgICAgICAgaW5mbyA9IHhibWNndWkuTGlzdEl0ZW0oJyVzKSAlcycgJShzdHIoaXRlbSksbmFtZSkpCiAgICAgICAgICAgICAgICBwbGF5bGlzdC5hZGQoaSwgaW5mbykKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ3BsYXlsaXN0LnBsYXlvZmZzZXQodmlkZW8sMCknKQoKCmRlZiBkb3dubG9hZF9maWxlKG5hbWUsIHVybCk6CiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpID09ICIiOgogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbignRGVqYVZ1JywnQ2hvb3NlIGEgbG9jYXRpb24gdG8gc2F2ZSBmaWxlcy4nLDE1MDAwLCIraWNvbisiKSIpCiAgICAgICAgICAgIGFkZG9uLm9wZW5TZXR0aW5ncygpCiAgICAgICAgcGFyYW1zID0geyd1cmwnOiB1cmwsICdkb3dubG9hZF9wYXRoJzogYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpfQogICAgICAgIGRvd25sb2FkZXIuZG93bmxvYWQobmFtZSwgcGFyYW1zKQogICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkKICAgICAgICByZXQgPSBkaWFsb2cueWVzbm8oJ0RlamFWdScsICdEbyB5b3Ugd2FudCB0byBhZGQgdGhpcyBmaWxlIGFzIGEgc291cmNlPycpCiAgICAgICAgaWYgcmV0OgogICAgICAgICAgICBhZGRTb3VyY2Uob3MucGF0aC5qb2luKGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKSwgbmFtZSkpCgoKZGVmIGFkZERpcihuYW1lLHVybCxtb2RlLGljb25pbWFnZSxmYW5hcnQsZGVzY3JpcHRpb24sZ2VucmUsZGF0ZSxjcmVkaXRzLHNob3djb250ZXh0PUZhbHNlKToKICAgICAgICAKICAgICAgICB1PXN5cy5hcmd2WzBdKyI/dXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9IitzdHIobW9kZSkrIiZuYW1lPSIrdXJsbGliLnF1b3RlX3BsdXMobmFtZSkrIiZpY29uaW1hZ2U9Iit1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpKyImZmFuYXJ0PSIrdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KQogICAgICAgIG9rPVRydWUKICAgICAgICBpZiBkYXRlID09ICcnOgogICAgICAgICAgICBkYXRlID0gTm9uZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcblxuRGF0ZTogJXMnICVkYXRlCiAgICAgICAgbGl6PXhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPSJEZWZhdWx0Rm9sZGVyLnBuZyIsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkKICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lLCAiUGxvdCI6IGRlc2NyaXB0aW9uLCAiR2VucmUiOiBnZW5yZSwgImRhdGVhZGRlZCI6IGRhdGUsICJjcmVkaXRzIjogY3JlZGl0cyB9KQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQogICAgICAgIGlmIHNob3djb250ZXh0OgogICAgICAgICAgICBjb250ZXh0TWVudSA9IFtdCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICdzb3VyY2UnOgogICAgICAgICAgICAgICAgaWYgbmFtZSBpbiBzdHIoU09VUkNFUyk6CiAgICAgICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnUmVtb3ZlIGZyb20gU291cmNlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9OCZuYW1lPSVzKScgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgZWxpZiBzaG93Y29udGV4dCA9PSAnZG93bmxvYWQnOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnRG93bmxvYWQnLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT05Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgICAgICBlbGlmIHNob3djb250ZXh0ID09ICdmYXYnOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnUmVtb3ZlIGZyb20gQWRkLW9uIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NiZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKCQkJCQkJCQkJCiAgICAgICAgICAgIGlmIG5vdCBuYW1lIGluIEZBVjoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FkZCB0byBBZGQtb24gRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT01Jm5hbWU9JXMmdXJsPSVzJmljb25pbWFnZT0lcyZmYW5hcnQ9JXMmZmF2X21vZGU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSksIHVybGxpYi5xdW90ZV9wbHVzKGZhbmFydCksIG1vZGUpKSkKICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpCiAgICAgICAgb2s9eGJtY3BsdWdpbi5hZGREaXJlY3RvcnlJdGVtKGhhbmRsZT1pbnQoc3lzLmFyZ3ZbMV0pLHVybD11LGxpc3RpdGVtPWxpeixpc0ZvbGRlcj1UcnVlKQoKICAgICAgICByZXR1cm4gb2sKZGVmIHl0ZGxfZG93bmxvYWQodXJsLHRpdGxlLG1lZGlhX3R5cGU9J3ZpZGVvJyk6CiAgICAjIHBsYXkgaW4geGJtYyB3aGlsZSBwbGF5aW5nIGdvIGJhY2sgdG8gY29udGV4dE1lbnUoYykgdG8gIiEhRG93bmxvYWQhISIKICAgICMgVHJpYWwgeWFzY2Vlbjogc2VwZXJhdGUgfFVzZXItQWdlbnQ9CiAgICBpbXBvcnQgeW91dHViZWRsCiAgICBpZiBub3QgdXJsID09ICcnOgogICAgICAgIGlmIG1lZGlhX3R5cGU9PSAnYXVkaW8nOgogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKHVybCxkb3dubG9hZD1UcnVlLGF1ZGlvPVRydWUpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCh1cmwsZG93bmxvYWQ9VHJ1ZSkgICAKICAgIGVsaWYgeGJtYy5QbGF5ZXIoKS5pc1BsYXlpbmcoKSA9PSBUcnVlIDoKICAgICAgICBpbXBvcnQgWURTdHJlYW1FeHRyYWN0b3IKICAgICAgICBpZiBZRFN0cmVhbUV4dHJhY3Rvci5pc0Rvd25sb2FkaW5nKCkgPT0gVHJ1ZToKCiAgICAgICAgICAgIFlEU3RyZWFtRXh0cmFjdG9yLm1hbmFnZURvd25sb2FkcygpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeGJtY191cmwgPSB4Ym1jLlBsYXllcigpLmdldFBsYXlpbmdGaWxlKCkKCiAgICAgICAgICAgIHhibWNfdXJsID0geGJtY191cmwuc3BsaXQoJ3xVc2VyLUFnZW50PScpWzBdCiAgICAgICAgICAgIGluZm8gPSB7J3VybCc6eGJtY191cmwsJ3RpdGxlJzp0aXRsZSwnbWVkaWFfdHlwZSc6bWVkaWFfdHlwZX0KICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCgnJyxkb3dubG9hZD1UcnVlLGRsX2luZm89aW5mbykgICAgCiAgICBlbHNlOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKERPV05MT0FELEZpcnN0IFBsYXkgW0NPTE9SIHllbGxvd11XSElMRSBwbGF5aW5nIGRvd25sb2FkWy9DT0xPUl0gLDEwMDAwKSIpCiAKZGVmIHNlYXJjaChzaXRlX25hbWUsc2VhcmNoX3Rlcm09Tm9uZSk6CiAgICB0aHVtYm5haWw9JycKICAgIGlmIG9zLnBhdGguZXhpc3RzKGhpc3RvcnkpID09IEZhbHNlIG9yIGFkZG9uLmdldFNldHRpbmcoJ2NsZWFyc2VhY2hoaXN0b3J5Jyk9PSd0cnVlJzoKICAgICAgICBTYXZlVG9GaWxlKGhpc3RvcnksJycpCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygiY2xlYXJzZWFjaGhpc3RvcnkiLCJmYWxzZSIpCiAgICBpZiBzaXRlX25hbWUgPT0gJ2hpc3RvcnknIDoKICAgICAgICBjb250ZW50ID0gTG9hZEZpbGUoaGlzdG9yeSkKICAgICAgICBtYXRjaCA9IHJlLmNvbXBpbGUoJyguKz8pOiguKj8pKD86XHJ8XG4pJykuZmluZGFsbChjb250ZW50KQoKICAgICAgICBmb3IgbmFtZSxzZWFyY2hfdGVybSBpbiBtYXRjaDoKICAgICAgICAgICAgaWYgJ3BsdWdpbjovLycgaW4gc2VhcmNoX3Rlcm06CiAgICAgICAgICAgICAgICBhZGRMaW5rKHNlYXJjaF90ZXJtLCBuYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLCcnLHRvdGFsPWludChsZW4obWF0Y2gpKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lKyc6JytzZWFyY2hfdGVybSxuYW1lLDI2LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgaWYgbm90IHNlYXJjaF90ZXJtOiAgICAKICAgICAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQoJycsJ0VudGVyIFNlYXJjaCBUZXJtJykKICAgICAgICBrZXlib2FyZC5kb01vZGFsKCkKICAgICAgICBpZiAoa2V5Ym9hcmQuaXNDb25maXJtZWQoKSA9PSBGYWxzZSk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIHNlYXJjaF90ZXJtID0ga2V5Ym9hcmQuZ2V0VGV4dCgpCiAgICAgICAgaWYgbGVuKHNlYXJjaF90ZXJtKSA9PSAwOgogICAgICAgICAgICByZXR1cm4gICAgICAgIAogICAgc2VhcmNoX3Rlcm0gPSBzZWFyY2hfdGVybS5yZXBsYWNlKCcgJywnKycpCiAgICBzZWFyY2hfdGVybSA9IHNlYXJjaF90ZXJtLmVuY29kZSgndXRmLTgnKQogICAgaWYgJ3lvdXR1YmUnIGluIHNpdGVfbmFtZToKICAgICAgICAjeW91dHViZSA9IHlvdXR1YmUjTGFuYSBEZWwgUmV5CiAgICAgICAgaW1wb3J0IF95dHBsaXN0CgogICAgICAgIHNlYXJjaF9yZXMgPSB7fQogICAgICAgIHNlYXJjaF9yZXMgPSBfeXRwbGlzdC5Zb1VUdWJlKCdzZWFyY2hZVCcseW91dHViZT1zZWFyY2hfdGVybSxtYXhfcGFnZT00LG5vc2F2ZT0nbm9zYXZlJykKICAgICAgICB0b3RhbCA9IGxlbihzZWFyY2hfcmVzKQogICAgICAgIGZvciBpdGVtIGluIHNlYXJjaF9yZXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG5hbWUgPSBzZWFyY2hfcmVzW2l0ZW1dWyd0aXRsZSddCiAgICAgICAgICAgICAgICBkYXRlPSBzZWFyY2hfcmVzW2l0ZW1dWydkYXRlJ10KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHNlYXJjaF9yZXNbaXRlbV1bJ2Rlc2MnXQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICdVTkFWQUlBQkxFJwoKICAgICAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz92aWRlb19pZD0nICsgc2VhcmNoX3Jlc1tpdGVtXVsndXJsJ10KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9J2h0dHA6Ly9pbWcueW91dHViZS5jb20vdmkvJytzZWFyY2hfcmVzW2l0ZW1dWyd1cmwnXSsnLzAuanBnJwogICAgICAgICAgICAgICAgYWRkTGluayh1cmwsIG5hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWwpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIAlhZGRvbl9sb2coICdUaGlzIGl0ZW0gaXMgaWdub3JlZDo6JykKICAgICAgICBwYWdlX2RhdGEgPSBzaXRlX25hbWUgKyc6Jysgc2VhcmNoX3Rlcm0gKyAnXG4nCiAgICAgICAgU2F2ZVRvRmlsZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwnaGlzdG9yeScpLHBhZ2VfZGF0YSxhcHBlbmQ9VHJ1ZSkKICAgIGVsaWYgJ2Rtb3Rpb24nIGluIHNpdGVfbmFtZToKICAgICAgICB1cmxNYWluID0gImh0dHBzOi8vYXBpLmRhaWx5bW90aW9uLmNvbSIgCiAgICAgICAgI3lvdXR1YmUgPSB5b3V0dWJlI0xhbmEgRGVsIFJleQogICAgICAgIGltcG9ydCBfRE1zZWFyY2gKICAgICAgICBmYW1pbHlGaWx0ZXIgPSBzdHIoYWRkb24uZ2V0U2V0dGluZygnZmFtaWx5RmlsdGVyJykpCiAgICAgICAgX0RNc2VhcmNoLmxpc3RWaWRlb3ModXJsTWFpbisiL3ZpZGVvcz9maWVsZHM9ZGVzY3JpcHRpb24sZHVyYXRpb24saWQsb3duZXIudXNlcm5hbWUsdGFrZW5fdGltZSx0aHVtYm5haWxfbGFyZ2VfdXJsLHRpdGxlLHZpZXdzX3RvdGFsJnNlYXJjaD0iK3NlYXJjaF90ZXJtKyImc29ydD1yZWxldmFuY2UmbGltaXQ9MTAwJmZhbWlseV9maWx0ZXI9IitmYW1pbHlGaWx0ZXIrIiZsb2NhbGl6YXRpb249ZW5fRU4mcGFnZT0xIikKICAgIAogICAgICAgIHBhZ2VfZGF0YSA9IHNpdGVfbmFtZSArJzonKyBzZWFyY2hfdGVybSsgJ1xuJwogICAgICAgIFNhdmVUb0ZpbGUob3MucGF0aC5qb2luKHByb2ZpbGUsJ2hpc3RvcnknKSxwYWdlX2RhdGEsYXBwZW5kPVRydWUpICAgICAgICAKICAgIGVsaWYgJ0lNREJpZHBsYXknIGluIHNpdGVfbmFtZToKICAgICAgICB1cmxNYWluID0gImh0dHA6Ly93d3cub21kYmFwaS5jb20vP3Q9IiAKICAgICAgICB1cmw9IHVybE1haW4rc2VhcmNoX3Rlcm0KCiAgICAgICAgaGVhZGVycyA9IGRpY3QoeydVc2VyLUFnZW50JzonTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4zOyBydjozMy4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzMzLjAnLCdSZWZlcmVyJzogJ2h0dHA6Ly9qb2tlci5vcmcvJywnQWNjZXB0LUVuY29kaW5nJzonZ3ppcCwgZGVmbGF0ZScsJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnLCdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qJ30pCiAgICAKICAgICAgICByPXJlcXVlc3RzLmdldCh1cmwsaGVhZGVycz1oZWFkZXJzKQogICAgICAgIGRhdGEgPSByLmpzb24oKQogICAgICAgIHJlcyA9IGRhdGFbJ1Jlc3BvbnNlJ10KICAgICAgICBpZiByZXMgPT0gJ1RydWUnOgogICAgICAgICAgICBpbWRiSUQgPSBkYXRhWydpbWRiSUQnXQogICAgICAgICAgICBuYW1lPSBkYXRhWydUaXRsZSddICsgZGF0YVsnUmVsZWFzZWQnXQogICAgICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgICAgIHJldCA9IGRpYWxvZy55ZXNubygnQ2hlY2sgTW92aWUgVGl0bGUnLCAnUExBWSA6OiAlcyA/JyVuYW1lKQogICAgICAgICAgICBpZiByZXQ6CiAgICAgICAgICAgICAgICB1cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9tb3ZpZS8nK2ltZGJJRCsnL3BsYXknCiAgICAgICAgICAgICAgICBwYWdlX2RhdGEgPSBuYW1lICsnOicrIHVybCsgJ1xuJwogICAgICAgICAgICAgICAgU2F2ZVRvRmlsZShoaXN0b3J5LHBhZ2VfZGF0YSxhcHBlbmQ9VHJ1ZSkKICAgICAgICAgICAgICAgIHJldHVybiB1cmwKICAgICAgICBlbHNlOgogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihTaW1wbGVLb3JlLE5vIElNREIgbWF0Y2ggZm91bmQgLDcwMDAsIitpY29uKyIpIikKIyMgTHVuYXRpeHogUHNldWRvVFYgZmVhdHVyZQpkZWYgYXNjaWkoc3RyaW5nKToKICAgIGlmIGlzaW5zdGFuY2Uoc3RyaW5nLCBiYXNlc3RyaW5nKToKICAgICAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6CiAgICAgICAgICAgc3RyaW5nID0gc3RyaW5nLmVuY29kZSgnYXNjaWknLCAnaWdub3JlJykKICAgIHJldHVybiBzdHJpbmcKZGVmIHVuaShzdHJpbmcsIGVuY29kaW5nID0gJ3V0Zi04Jyk6CiAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgYmFzZXN0cmluZyk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uoc3RyaW5nLCB1bmljb2RlKToKICAgICAgICAgICAgc3RyaW5nID0gdW5pY29kZShzdHJpbmcsIGVuY29kaW5nLCAnaWdub3JlJykKICAgIHJldHVybiBzdHJpbmcKZGVmIHJlbW92ZU5vbkFzY2lpKHMpOiByZXR1cm4gIiIuam9pbihmaWx0ZXIobGFtYmRhIHg6IG9yZCh4KTwxMjgsIHMpKQoKZGVmIHNlbmRKU09OKCBjb21tYW5kKToKICAgIGRhdGEgPSAnJwogICAgdHJ5OgogICAgICAgIGRhdGEgPSB4Ym1jLmV4ZWN1dGVKU09OUlBDKHVuaShjb21tYW5kKSkKICAgIGV4Y2VwdCBVbmljb2RlRW5jb2RlRXJyb3I6CiAgICAgICAgZGF0YSA9IHhibWMuZXhlY3V0ZUpTT05SUEMoYXNjaWkoY29tbWFuZCkpCgogICAgcmV0dXJuIHVuaShkYXRhKQoKI2hha2FtYWMgdGhhbmtzIFJvbWFuX1ZfTQpkZWYgU2V0Vmlld1RodW1ibmFpbCgpOgogICAgc2tpbl91c2VkID0geGJtYy5nZXRTa2luRGlyKCkKICAgIGlmIHNraW5fdXNlZCA9PSAnc2tpbi5jb25mbHVlbmNlJzoKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKScpCiAgICBlbGlmIHNraW5fdXNlZCA9PSAnc2tpbi5hZW9uLm5veCc6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignQ29udGFpbmVyLlNldFZpZXdNb2RlKDUxMSknKSAKICAgIGVsc2U6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCknKQoJCgkKZGVmIHBsdWdpbnF1ZXJ5YnlKU09OKHVybCk6CiAgICBqc29uX3F1ZXJ5ID0gdW5pKCd7Impzb25ycGMiOiIyLjAiLCJtZXRob2QiOiJGaWxlcy5HZXREaXJlY3RvcnkiLCJwYXJhbXMiOnsiZGlyZWN0b3J5IjoiJXMiLCJtZWRpYSI6InZpZGVvIiwicHJvcGVydGllcyI6WyJ0aHVtYm5haWwiLCJ0aXRsZSIsInllYXIiLCJkYXRlYWRkZWQiLCJmYW5hcnQiLCJyYXRpbmciLCJzZWFzb24iLCJlcGlzb2RlIiwic3R1ZGlvIl19LCJpZCI6MX0nKSAldXJsCgogICAganNvbl9mb2xkZXJfZGV0YWlsID0ganNvbi5sb2FkcyhzZW5kSlNPTihqc29uX3F1ZXJ5KSkKICAgIGZvciBpIGluIGpzb25fZm9sZGVyX2RldGFpbFsncmVzdWx0J11bJ2ZpbGVzJ10gOgogICAgICAgIHVybCA9IGlbJ2ZpbGUnXQogICAgICAgIG5hbWUgPSByZW1vdmVOb25Bc2NpaShpWydsYWJlbCddKQogICAgICAgIHRodW1ibmFpbCA9IHJlbW92ZU5vbkFzY2lpKGlbJ3RodW1ibmFpbCddKQogICAgICAgIHRyeToKICAgICAgICAgICAgZmFuYXJ0ID0gcmVtb3ZlTm9uQXNjaWkoaVsnZmFuYXJ0J10pCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZmFuYXJ0ID0gJycKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRhdGUgPSBpWyd5ZWFyJ10KICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBkYXRlID0gJycKICAgICAgICB0cnk6CiAgICAgICAgICAgIGVwaXNvZGUgPSBpWydlcGlzb2RlJ10KICAgICAgICAgICAgc2Vhc29uID0gaVsnc2Vhc29uJ10KICAgICAgICAgICAgaWYgZXBpc29kZSA9PSAtMSBvciBzZWFzb24gPT0gLTE6CiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICcnCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICdbQ09MT1IgeWVsbG93XSBTJyArIHN0cihzZWFzb24pKydbL0NPTE9SXVtDT0xPUiBob3RwaW5rXSBFJyArIHN0cihlcGlzb2RlKSArJ1svQ09MT1JdJwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJycKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN0dWRpbyA9IGlbJ3N0dWRpbyddCiAgICAgICAgICAgIGlmIHN0dWRpbzoKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcbiBTdHVkaW86W0NPTE9SIHN0ZWVsYmx1ZV0gJyArIHN0dWRpb1swXSArICdbL0NPTE9SXScKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBzdHVkaW8gPSAnJwoKICAgICAgICBpZiBpWydmaWxldHlwZSddID09ICdmaWxlJzoKICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSx0aHVtYm5haWwsZmFuYXJ0LGRlc2NyaXB0aW9uLCcnLGRhdGUsJycsTm9uZSwnJyx0b3RhbD1sZW4oanNvbl9mb2xkZXJfZGV0YWlsWydyZXN1bHQnXVsnZmlsZXMnXSkpCiAgICAgICAgICAgICN4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKSIpCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCw1Myx0aHVtYm5haWwsZmFuYXJ0LGRlc2NyaXB0aW9uLCcnLGRhdGUsJycpCiAgICAgICAgICAgICN4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKSIpCgpkZWYgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuYXJ0LGRlc2NyaXB0aW9uLGdlbnJlLGRhdGUsc2hvd2NvbnRleHQscGxheWxpc3QscmVnZXhzLHRvdGFsLHNldENvb2tpZT0iIik6CiAgICAgICAgI3ByaW50ICd1cmwsbmFtZScsdXJsLG5hbWUKICAgICAgICBjb250ZXh0TWVudSA9W10KICAgICAgICB0cnk6CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLmVuY29kZSgndXRmLTgnKQogICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgIG9rID0gVHJ1ZQogICAgICAgCiAgICAgICAgaWYgcmVnZXhzOiAKICAgICAgICAgICAgbW9kZSA9ICcxNycKICAgICAgICAgICAKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpICAgICAgICAgICAKICAgICAgICBlbGlmICBhbnkoeCBpbiB1cmwgZm9yIHggaW4gcmVzb2x2ZV91cmwpIGFuZCAgdXJsLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgbW9kZSA9ICcxOScKICAgICAgICAgIAogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkgICAgICAgICAgIAogICAgICAgIGVsaWYgdXJsLmVuZHN3aXRoKCcmbW9kZT0xOCcpOgogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyZtb2RlPTE4JywnJykKICAgICAgICAgICAgbW9kZSA9ICcxOCcgCiAgICAgICAgICAKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQhIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjMmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpIAogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdkbGF1ZGlvb25seScpID09ICd0cnVlJzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJyEhRG93bmxvYWQgW0NPTE9SIHNlYWJsdWVdQXVkaW8hIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjQmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBlbGlmIHVybC5zdGFydHN3aXRoKCdtYWduZXQ6P3h0PScpIG9yICcudG9ycmVudCcgaW4gdXJsOgogICAgICAgICAgCiAgICAgICAgICAgIGlmICcmJyBpbiB1cmwgYW5kIG5vdCAnJmFtcDsnIGluIHVybCA6CiAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgnJicsJyZhbXA7JykKICAgICAgICAgICAgdXJsID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wdWxzYXIvcGxheT91cmk9JyArIHVybAogICAgICAgICAgICBtb2RlID0gJzEyJwogICAgICAgICAgICAgICAgICAgICAKICAgICAgICBlbHNlOiAKICAgICAgICAgICAgbW9kZSA9ICcxMicKICAgICAgCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkIEN1cnJlbnRseSBQbGF5aW5nISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgCiAgICAgICAgdT1zeXMuYXJndlswXSsiPyIKICAgICAgICBwbGF5X2xpc3QgPSBGYWxzZQogICAgICAKICAgICAgICBpZiBwbGF5bGlzdDoKICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYWRkX3BsYXlsaXN0JykgPT0gImZhbHNlIjoKICAgICAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdSArPSAibW9kZT0xMyZuYW1lPSVzJnBsYXlsaXN0PSVzIiAlKHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICsgJ1tDT0xPUiBtYWdlbnRhXSAoJyArIHN0cihsZW4ocGxheWxpc3QpKSArICcgaXRlbXMgKVsvQ09MT1JdJwogICAgICAgICAgICAgICAgcGxheV9saXN0ID0gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQogICAgICAgIGlmIHJlZ2V4czoKICAgICAgICAgICAgdSArPSAiJnJlZ2V4cz0iK3JlZ2V4cwogICAgICAgIGlmIG5vdCBzZXRDb29raWUgPT0gJyc6CiAgICAgICAgICAgIHUgKz0gIiZzZXRDb29raWU9Iit1cmxsaWIucXVvdGVfcGx1cyhzZXRDb29raWUpCiAgCiAgICAgICAgaWYgZGF0ZSA9PSAnJzoKICAgICAgICAgICAgZGF0ZSA9IE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnXG5cbkRhdGU6ICVzJyAlZGF0ZQogICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT0iRGVmYXVsdFZpZGVvLnBuZyIsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkKICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lLCAiUGxvdCI6IGRlc2NyaXB0aW9uLCAiR2VucmUiOiBnZW5yZSwgImRhdGVhZGRlZCI6IGRhdGUgfSkKICAgICAgICBsaXouc2V0UHJvcGVydHkoIkZhbmFydF9JbWFnZSIsIGZhbmFydCkKICAgICAgICAKICAgICAgICBpZiAobm90IHBsYXlfbGlzdCkgYW5kIG5vdCBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCk6IyAgKG5vdCB1cmwuc3RhcnRzd2l0aCgncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3RlcicpKToKICAgICAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICAgICAgaWYgJyRweUZ1bmN0aW9uOnBsYXltZWRpYSgnIG5vdCBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgYW5kICdub3RwbGF5YWJsZScgbm90IGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSAgOgogICAgICAgICAgICAgICAgICAgICNwcmludCAnc2V0dGluZyBpc3BsYXlhYmxlJyx1cmwsIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSx1cmwKICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ0lzUGxheWFibGUnLCAndHJ1ZScpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ0lzUGxheWFibGUnLCAndHJ1ZScpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCAnTk9UIHNldHRpbmcgaXNwbGF5YWJsZScrdXJsKQogICAgICAgCiAgICAgICAgaWYgc2hvd2NvbnRleHQ6CiAgICAgICAgICAgIGNvbnRleHRNZW51ID0gW10KICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJ2Zhdic6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgKCdSZW1vdmUgZnJvbSBBZGQtb24gRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT02Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpCiAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxpZiBub3QgbmFtZSBpbiBGQVY6CiAgICAgICAgICAgICAgICBmYXZfcGFyYW1zID0gKAogICAgICAgICAgICAgICAgICAgICclcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0wJwogICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIHBsYXlsaXN0OgogICAgICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgKz0gJ3BsYXlsaXN0PScrdXJsbGliLnF1b3RlX3BsdXMoc3RyKHBsYXlsaXN0KS5yZXBsYWNlKCcsJywnfHwnKSkKICAgICAgICAgICAgICAgIGlmIHJlZ2V4czoKICAgICAgICAgICAgICAgICAgICBmYXZfcGFyYW1zICs9ICImcmVnZXhzPSIrcmVnZXhzCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdBZGQgdG8gQWRkLW9uIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzKScgJWZhdl9wYXJhbXMpKQogICAgICAgICAgICBsaXouYWRkQ29udGV4dE1lbnVJdGVtcyhjb250ZXh0TWVudSkKICAgICAgIAogICAgICAgIGlmIG5vdCBwbGF5bGlzdCBpcyBOb25lOgogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgcGxheWxpc3RfbmFtZSA9IG5hbWUuc3BsaXQoJykgJylbMV0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51XyA9IFsKICAgICAgICAgICAgICAgICAgICAoJ1BsYXkgJytwbGF5bGlzdF9uYW1lKycgUGxheUxpc3QnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTEzJm5hbWU9JXMmcGxheWxpc3Q9JXMpJwogICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhwbGF5bGlzdF9uYW1lKSwgdXJsbGliLnF1b3RlX3BsdXMoc3RyKHBsYXlsaXN0KS5yZXBsYWNlKCcsJywnfHwnKSkpKQogICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICBsaXouYWRkQ29udGV4dE1lbnVJdGVtcyhjb250ZXh0TWVudV8pCiAgICAgICAgI3ByaW50ICdhZGRpbmcnLG5hbWUKICMgICAgICAgcHJpbnQgdXJsLHRvdGFsaXRlbXMKICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPXUsbGlzdGl0ZW09bGl6LHRvdGFsSXRlbXM9dG90YWwpCiAgICAgICAgI3ByaW50ICdhZGRlZCcsbmFtZQogICAgICAgIHJldHVybiBvawoKZGVmIHBsYXlzZXRyZXNvbHZlZCh1cmwsbmFtZSxpY29uaW1hZ2Usc2V0cmVzb2x2ZWQ9VHJ1ZSk6CiAgICBpZiBzZXRyZXNvbHZlZDoKICAgICAgICBsaXogPSB4Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UpCiAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOm5hbWV9KQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsInRydWUiKQogICAgICAgIGxpei5zZXRQYXRoKHN0cih1cmwpKQogICAgICAgIHhibWNwbHVnaW4uc2V0UmVzb2x2ZWRVcmwoaW50KHN5cy5hcmd2WzFdKSwgVHJ1ZSwgbGl6KQogICAgZWxzZToKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpICAgICAgCgoKIyMgVGhhbmtzIHRvIGRhc2NoYWNrYSwgYW4gZXBnIHNjcmFwZXIgZm9yIGh0dHA6Ly9pLnRlbGVib3kuY2gvcHJvZ3JhbW0vc3RhdGlvbl9zZWxlY3QucGhwCiMjICBodHRwOi8vZm9ydW0ueGJtYy5vcmcvcG9zdC5waHA/cD05MzYyMjgmcG9zdGNvdW50PTEwNzYKZGVmIGdldGVwZyhsaW5rKToKICAgICAgICB1cmw9dXJsbGliLnVybG9wZW4obGluaykKICAgICAgICBzb3VyY2U9dXJsLnJlYWQoKQogICAgICAgIHVybC5jbG9zZSgpCiAgICAgICAgc291cmNlMiA9IHNvdXJjZS5zcGxpdCgiSmV0enQiKQogICAgICAgIHNvdXJjZTMgPSBzb3VyY2UyWzFdLnNwbGl0KCdwcm9ncmFtbS9kZXRhaWwucGhwP2NvbnN0X2lkPScpCiAgICAgICAgc291cmNldWhyemVpdCA9IHNvdXJjZTNbMV0uc3BsaXQoJzxiciAvPjxhIGhyZWY9Ii8nKQogICAgICAgIG5vd3RpbWUgPSBzb3VyY2V1aHJ6ZWl0WzBdWzQwOmxlbihzb3VyY2V1aHJ6ZWl0WzBdKV0KICAgICAgICBzb3VyY2V0aXRsZSA9IHNvdXJjZTNbMl0uc3BsaXQoIjwvYT48L3A+PC9kaXY+IikKICAgICAgICBub3d0aXRsZSA9IHNvdXJjZXRpdGxlWzBdWzE3Omxlbihzb3VyY2V0aXRsZVswXSldCiAgICAgICAgbm93dGl0bGUgPSBub3d0aXRsZS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICByZXR1cm4gIiAgLSAiK25vd3RpdGxlKyIgLSAiK25vd3RpbWUKCgpkZWYgZ2V0X2VwZyh1cmwsIHJlZ2V4KToKICAgICAgICBkYXRhID0gbWFrZVJlcXVlc3QodXJsKQogICAgICAgIHRyeToKICAgICAgICAgICAgaXRlbSA9IHJlLmZpbmRhbGwocmVnZXgsIGRhdGEpWzBdCiAgICAgICAgICAgIHJldHVybiBpdGVtCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBhZGRvbl9sb2coJ3JlZ2V4IGZhaWxlZCcpCiAgICAgICAgICAgIGFkZG9uX2xvZyhyZWdleCkKICAgICAgICAgICAgcmV0dXJuCgoKeGJtY3BsdWdpbi5zZXRDb250ZW50KGludChzeXMuYXJndlsxXSksICdtb3ZpZXMnKQoKdHJ5OgogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfVU5TT1JURUQpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfTEFCRUwpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfREFURSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9HRU5SRSkKZXhjZXB0OgogICAgcGFzcwoKcGFyYW1zPWdldF9wYXJhbXMoKQoKdXJsPU5vbmUKbmFtZT1Ob25lCm1vZGU9Tm9uZQpwbGF5bGlzdD1Ob25lCmljb25pbWFnZT1Ob25lCmZhbmFydD1GQU5BUlQKcGxheWxpc3Q9Tm9uZQpmYXZfbW9kZT1Ob25lCnJlZ2V4cz1Ob25lCgp0cnk6CiAgICB1cmw9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbInVybCJdKS5kZWNvZGUoJ3V0Zi04JykKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBuYW1lPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJuYW1lIl0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgaWNvbmltYWdlPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJpY29uaW1hZ2UiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBmYW5hcnQ9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbImZhbmFydCJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIG1vZGU9aW50KHBhcmFtc1sibW9kZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHBsYXlsaXN0PWV2YWwodXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbInBsYXlsaXN0Il0pLnJlcGxhY2UoJ3x8JywnLCcpKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIGZhdl9tb2RlPWludChwYXJhbXNbImZhdl9tb2RlIl0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgcmVnZXhzPXBhcmFtc1sicmVnZXhzIl0KZXhjZXB0OgogICAgcGFzcwoKYWRkb25fbG9nKCJNb2RlOiAiK3N0cihtb2RlKSkKaWYgbm90IHVybCBpcyBOb25lOgogICAgYWRkb25fbG9nKCJVUkw6ICIrc3RyKHVybC5lbmNvZGUoJ3V0Zi04JykpKQphZGRvbl9sb2coIk5hbWU6ICIrc3RyKG5hbWUpKQoKaWYgbW9kZT09Tm9uZToKICAgIGFkZG9uX2xvZygiSW5kZXgiKQogICAgU0tpbmRleCgpCQoKZWxpZiBtb2RlPT0xOgogICAgYWRkb25fbG9nKCJnZXREYXRhIikKICAgIGdldERhdGEodXJsLGZhbmFydCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MjoKICAgIGFkZG9uX2xvZygiZ2V0Q2hhbm5lbEl0ZW1zIikKICAgIGdldENoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTM6CiAgICBhZGRvbl9sb2coImdldFN1YkNoYW5uZWxJdGVtcyIpCiAgICBnZXRTdWJDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT00OgogICAgYWRkb25fbG9nKCJnZXRGYXZvcml0ZXMiKQogICAgZ2V0RmF2b3JpdGVzKCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09NToKICAgIGFkZG9uX2xvZygiYWRkRmF2b3JpdGUiKQogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCdcXCAnKVsxXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIHRyeToKICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnICAtICcpWzBdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxmYXZfbW9kZSkKCmVsaWYgbW9kZT09NjoKICAgIGFkZG9uX2xvZygicm1GYXZvcml0ZSIpCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcgIC0gJylbMF0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICBybUZhdm9yaXRlKG5hbWUpCgplbGlmIG1vZGU9PTc6CiAgICBhZGRvbl9sb2coImFkZFNvdXJjZSIpCiAgICBhZGRTb3VyY2UodXJsKQoKZWxpZiBtb2RlPT04OgogICAgYWRkb25fbG9nKCJybVNvdXJjZSIpCiAgICBybVNvdXJjZShuYW1lKQoKZWxpZiBtb2RlPT05OgogICAgYWRkb25fbG9nKCJkb3dubG9hZF9maWxlIikKICAgIGRvd25sb2FkX2ZpbGUobmFtZSwgdXJsKQoKZWxpZiBtb2RlPT0xMDoKICAgIGFkZG9uX2xvZygiZ2V0Q29tbXVuaXR5U291cmNlcyIpCiAgICBnZXRDb21tdW5pdHlTb3VyY2VzKCkKCmVsaWYgbW9kZT09MTE6CiAgICBhZGRvbl9sb2coImFkZFNvdXJjZSIpCiAgICBhZGRTb3VyY2UodXJsKQoKZWxpZiBtb2RlPT0xMjoKICAgIGFkZG9uX2xvZygic2V0UmVzb2x2ZWRVcmwiKQogICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCJwbHVnaW46Ly9wbHVnaW4iKSBvciBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOiNub3QgdXJsLnN0YXJ0c3dpdGgoInBsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIiKSA6CiAgICAgICAgaXRlbSA9IHhibWNndWkuTGlzdEl0ZW0ocGF0aD11cmwpCiAgICAgICAgeGJtY3BsdWdpbi5zZXRSZXNvbHZlZFVybChpbnQoc3lzLmFyZ3ZbMV0pLCBUcnVlLCBpdGVtKQogICAgZWxzZToKICAgICAgICBwcmludCAnTm90IHNldHRpbmcgc2V0UmVzb2x2ZWRVcmwnCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKQoKCmVsaWYgbW9kZT09MTM6CiAgICBhZGRvbl9sb2coInBsYXlfcGxheWxpc3QiKQogICAgcGxheV9wbGF5bGlzdChuYW1lLCBwbGF5bGlzdCkKCmVsaWYgbW9kZT09MTQ6CiAgICBhZGRvbl9sb2coImdldF94bWxfZGF0YWJhc2UiKQogICAgZ2V0X3htbF9kYXRhYmFzZSh1cmwpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTE1OgogICAgYWRkb25fbG9nKCJicm93c2VfeG1sX2RhdGFiYXNlIikKICAgIGdldF94bWxfZGF0YWJhc2UodXJsLCBUcnVlKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0xNjoKICAgIGFkZG9uX2xvZygiYnJvd3NlX2NvbW11bml0eSIpCiAgICBnZXRDb21tdW5pdHlTb3VyY2VzKFRydWUpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTE3OgogICAgYWRkb25fbG9nKCJnZXRSZWdleFBhcnNlZCIpCiAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCkKICAgIGlmIHVybDoKICAgICAgICBwbGF5c2V0cmVzb2x2ZWQodXJsLG5hbWUsaWNvbmltYWdlLHNldHJlc29sdmVkKQogICAgZWxzZToKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihEZWphVnUsRmFpbGVkIHRvIGV4dHJhY3QgcmVnZXguIC0gIisidGhpcyIrIiw0MDAwLCIraWNvbisiKSIpCmVsaWYgbW9kZT09MTg6CiAgICBhZGRvbl9sb2coInlvdXR1YmVkbCIpCiAgICB0cnk6CiAgICAgICAgaW1wb3J0IHlvdXR1YmVkbAogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihEZWphVnUsUGxlYXNlIFtDT0xPUiB5ZWxsb3ddaW5zdGFsbCB0aGUgWW91dHViZSBBZGRvblsvQ09MT1JdIG1vZHVsZSAsMTAwMDAsIiIpIikKICAgIHN0cmVhbV91cmw9eW91dHViZWRsLnNpbmdsZV9ZRCh1cmwpCiAgICBwbGF5c2V0cmVzb2x2ZWQoc3RyZWFtX3VybCxuYW1lLGljb25pbWFnZSkKZWxpZiBtb2RlPT0xOToKCWFkZG9uX2xvZygiR2VuZXNpc2NvbW1vbnJlc29sdmVycyIpCglwbGF5c2V0cmVzb2x2ZWQgKHVybHNvbHZlcih1cmwpLG5hbWUsaWNvbmltYWdlLFRydWUpCQoKZWxpZiBtb2RlPT0yMToKICAgIGFkZG9uX2xvZygiZG93bmxvYWQgY3VycmVudCBmaWxlIHVzaW5nIHlvdXR1YmUtZGwgc2VydmljZSIpCiAgICB5dGRsX2Rvd25sb2FkKCcnLG5hbWUsJ3ZpZGVvJykKZWxpZiBtb2RlPT0yMzoKICAgIGFkZG9uX2xvZygiZ2V0IGluZm8gdGhlbiBkb3dubG9hZCIpCiAgICB5dGRsX2Rvd25sb2FkKHVybCxuYW1lLCd2aWRlbycpIAplbGlmIG1vZGU9PTI0OgogICAgYWRkb25fbG9nKCJBdWRpbyBvbmx5IHlvdXR1YmUgZG93bmxvYWQiKQogICAgeXRkbF9kb3dubG9hZCh1cmwsbmFtZSwnYXVkaW8nKQplbGlmIG1vZGU9PTI1OgogICAgYWRkb25fbG9nKCJZb3VUdWJlL0RNb3Rpb24iKQogICAgc2VhcmNoKHVybCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKZWxpZiBtb2RlPT0yNjoKICAgIGFkZG9uX2xvZygiWW91VHViZS9ETW90aW9uIEZyb20gU2VhcmNoIEhpc3RvcnkiKQogICAgbmFtZSA9IG5hbWUuc3BsaXQoJzonKQogICAgc2VhcmNoKHVybCxzZWFyY2hfdGVybT1uYW1lWzFdKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGU9PTI3OgogICAgYWRkb25fbG9nKCJVc2luZyBJTURCIGlkIHRvIHBsYXkgaW4gUHVsc2FyIikKICAgIHB1bHNhcklNREI9c2VhcmNoKHVybCkKICAgIHhibWMuUGxheWVyKCkucGxheShwdWxzYXJJTURCKSAKZWxpZiBtb2RlPT0zMDoKICAgIEdldFN1YmxpbmtzKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQpCmVsaWYgbW9kZT09MzE6CiAgICBXaXpIRE1lbnUodXJsLGljb25pbWFnZSxmYW5hcnQpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCmVsaWYgbW9kZT09MzI6CglXaXpfR2V0X3VybCh1cmwpCgl4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCQoJCmVsaWYgbW9kZT09NDA6CiAgICBTZWFyY2hDaGFubmVscygpCiAgICBTZXRWaWV3VGh1bWJuYWlsKCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKZWxpZiBtb2RlID09IDQxIDogCiAgICBTZWFyY2hfaW5wdXQodXJsKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoJCmVsaWYgbW9kZT09NTM6CiAgICBhZGRvbl9sb2coIlJlcXVlc3RpbmcgSlNPTi1SUEMgSXRlbXMiKQogICAgcGx1Z2lucXVlcnlieUpTT04odXJsKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ==')
